<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rovigoal - Area Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #f0f2f5;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #FF4500 0%, #DC143C 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .menu-admin {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 800px;
            margin: 0 auto 40px;
        }
        
        .menu-btn {
            background: white;
            padding: 60px 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .menu-btn:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .menu-btn:nth-child(1) {
            background: linear-gradient(135deg, #1E90FF 0%, #4169E1 100%);
            color: white;
        }
        
        .menu-btn:nth-child(2) {
            background: linear-gradient(135deg, #32CD32 0%, #228B22 100%);
            color: white;
        }
        
        .icona {
            font-size: 3em;
            display: block;
            margin-bottom: 15px;
        }
        
        .sezione {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: none;
        }
        
        .sezione.attiva {
            display: block;
        }
        
        h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #FF4500;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .btn {
            background: linear-gradient(135deg, #FF4500 0%, #DC143C 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-full {
            width: 100%;
        }
        
        .btn-back {
            background: #1e3c72;
            margin: 20px auto;
            display: block;
            padding: 12px 30px;
        }
        
        .btn-green {
            background: linear-gradient(135deg, #32CD32 0%, #228B22 100%);
        }
        
        .btn-blue {
            background: linear-gradient(135deg, #1E90FF 0%, #4169E1 100%);
        }
        
        .btn-red {
            background: linear-gradient(135deg, #FF0000 0%, #DC143C 100%);
        }
        
        .btn-yellow {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
        }
        
        .giocatori-partita {
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            background: #f9f9f9;
        }
        
        .giocatore-eventi {
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .giocatore-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .contatori {
            display: flex;
            gap: 15px;
        }
        
        .contatore {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-contatore {
            background: #ddd;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }
        
        .valore-contatore {
            min-width: 30px;
            text-align: center;
            font-weight: bold;
        }
        
        .gol-segnati {
            background: #32CD32;
            color: white;
        }
        
        .ammonizioni {
            background: #FFD700;
            color: #333;
        }
        
        .espulsioni {
            background: #DC143C;
            color: white;
        }
        
        .eventi-salvati {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4ff;
            border-radius: 8px;
            border: 1px solid #b3d9ff;
        }
        
        .evento-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #cce0ff;
        }
        
        .evento-item:last-child {
            border-bottom: none;
        }
        
        .btn-rimuovi {
            background: #ff6666;
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .voto-container {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .voto-stelle {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .stella {
            font-size: 24px;
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s;
        }
        
        .stella.selezionata {
            color: #FFD700;
        }
        
        .hidden {
            display: none;
        }
        
        .avviso {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .avviso.errore {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß AREA ADMIN ROVIGOAL</h1>
        <p>Gestione completa del torneo</p>
    </div>
    
    <!-- MENU PRINCIPALE ADMIN -->
    <div class="menu-admin" id="menuPrincipale">
        <div class="menu-btn" onclick="mostraSezione('gestione')">
            <span class="icona">üë•</span>
            GESTIONE SQUADRE & GIOCATORI
        </div>
        <div class="menu-btn" onclick="mostraSezione('partite')">
            <span class="icona">‚öΩ</span>
            GESTIONE PARTITE
        </div>
    </div>
    
    <!-- SEZIONE GESTIONE SQUADRE E GIOCATORI -->
    <div id="gestione" class="sezione">
        <h2>üë• GESTIONE SQUADRE & GIOCATORI</h2>
        
        <!-- AGGIUNGI SQUADRA -->
        <div class="form-group">
            <h3>‚ûï AGGIUNGI SQUADRA</h3>
            <input type="text" id="nomeSquadra" placeholder="Nome Squadra (Es: Rovigo FC)">
            <input type="text" id="allenatore" placeholder="Allenatore">
            <input type="text" id="colori" placeholder="Colori (Es: Rosso-Blu)">
            <button class="btn btn-green btn-full" onclick="aggiungiSquadra()">AGGIUNGI SQUADRA</button>
        </div>
        
        <!-- AGGIUNGI GIOCATORE -->
        <div class="form-group">
            <h3>üë§ AGGIUNGI GIOCATORE</h3>
            <select id="squadraGiocatore">
                <option value="">Seleziona Squadra</option>
            </select>
            <input type="text" id="nomeGiocatore" placeholder="Nome e Cognome">
            <input type="number" id="numeroMaglia" placeholder="Numero Maglia">
            <select id="ruolo">
                <option value="Portiere">Portiere</option>
                <option value="Giocatore">Giocatore</option>
            </select>
            <button class="btn btn-blue btn-full" onclick="aggiungiGiocatore()">AGGIUNGI GIOCATORE</button>
        </div>
        
        <!-- ELIMINA DATI -->
        <div class="form-group">
            <h3>üóëÔ∏è ELIMINA DATI</h3>
            <select id="tipoElimina" onchange="mostraOpzioniElimina()">
                <option value="">Cosa vuoi eliminare?</option>
                <option value="giocatore">Elimina Giocatore</option>
                <option value="squadra">Elimina Squadra</option>
                <option value="tutto">Elimina TUTTO</option>
            </select>
            
            <div id="opzioniElimina" class="hidden">
                <!-- Qui appariranno le opzioni specifiche -->
            </div>
            
            <button class="btn btn-red btn-full hidden" id="btnElimina" onclick="eseguiEliminazione()">ELIMINA</button>
        </div>
        
        <button class="btn btn-back" onclick="tornaMenu()">‚Üê TORNA AL MENU</button>
    </div>
    
    <!-- SEZIONE GESTIONE PARTITE -->
    <div id="partite" class="sezione">
        <h2>‚öΩ GESTIONE PARTITE</h2>
        
        <!-- SELEZIONE SQUADRE -->
        <div class="form-group">
            <h3>üèüÔ∏è SELEZIONA PARTITA</h3>
            <select id="squadraCasa" onchange="caricaGiocatoriSquadra('casa')">
                <option value="">Squadra Casa</option>
            </select>
            <select id="squadraOspite" onchange="caricaGiocatoriSquadra('ospite')">
                <option value="">Squadra Ospite</option>
            </select>
        </div>
        
        <!-- RISULTATO PARTITA -->
        <div class="form-group">
            <h3>üìä RISULTATO PARTITA</h3>
            <div style="display: flex; gap: 20px; align-items: center;">
                <div style="flex: 1;">
                    <label>Gol Casa:</label>
                    <input type="number" id="golCasa" min="0" value="0" style="font-size: 24px; text-align: center;">
                </div>
                <div style="font-size: 24px; font-weight: bold;">-</div>
                <div style="flex: 1;">
                    <label>Gol Ospite:</label>
                    <input type="number" id="golOspite" min="0" value="0" style="font-size: 24px; text-align: center;">
                </div>
            </div>
        </div>
        
        <!-- GIOCATORI CASA -->
        <div id="giocatoriCasaContainer" class="hidden">
            <h3>üë• GIOCATORI CASA</h3>
            <div id="giocatoriCasa" class="giocatori-partita"></div>
        </div>
        
        <!-- GIOCATORI OSPITE -->
        <div id="giocatoriOspiteContainer" class="hidden">
            <h3>üë• GIOCATORI OSPITE</h3>
            <div id="giocatoriOspite" class="giocatori-partita"></div>
        </div>
        
        <!-- EVENTI SALVATI -->
        <div id="eventiSalvatiContainer" class="hidden">
            <h3>üìù EVENTI REGISTRATI</h3>
            <div id="eventiSalvati" class="eventi-salvati">
                Nessun evento registrato
            </div>
            
            <div class="avviso" id="avvisoGol">
                ‚ö†Ô∏è Controlla che il totale gol dei giocatori corrisponda al risultato della partita
            </div>
        </div>
        
        <!-- BOTTONI AZIONE -->
        <div class="btn-group" style="margin-top: 20px;">
            <button class="btn btn-yellow" onclick="resetPartita()">üîÑ RESET PARTITA</button>
            <button class="btn btn-green" onclick="salvaPartita()">üíæ SALVA PARTITA</button>
        </div>
        
        <button class="btn btn-back" onclick="tornaMenu()">‚Üê TORNA AL MENU</button>
    </div>
    
    <script>
        // Database in memoria
        let database = {
            squadre: JSON.parse(localStorage.getItem('rovigoal_squadre')) || [],
            giocatori: JSON.parse(localStorage.getItem('rovigoal_giocatori')) || [],
            partite: JSON.parse(localStorage.getItem('rovigoal_partite')) || []
        };
        
        // Partita in corso
        let partitaInCorso = {
            eventi: [],
            golTotaliCasa: 0,
            golTotaliOspite: 0
        };
        
        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            caricaSquadreNeiSelect();
            document.getElementById('menuPrincipale').style.display = 'grid';
            document.getElementById('gestione').classList.remove('attiva');
            document.getElementById('partite').classList.remove('attiva');
        });
        
        // Mostra/nascondi sezioni
        function mostraSezione(sezione) {
            document.getElementById('menuPrincipale').style.display = 'none';
            document.getElementById('gestione').classList.remove('attiva');
            document.getElementById('partite').classList.remove('attiva');
            document.getElementById(sezione).classList.add('attiva');
            
            if(sezione === 'gestione') {
                caricaSquadreNeiSelect();
            } else if(sezione === 'partite') {
                resetPartita();
            }
        }
        
        function tornaMenu() {
            document.getElementById('menuPrincipale').style.display = 'grid';
            document.getElementById('gestione').classList.remove('attiva');
            document.getElementById('partite').classList.remove('attiva');
        }
        
        // Carica squadre nei select
        function caricaSquadreNeiSelect() {
            const selects = [
                document.getElementById('squadraGiocatore'),
                document.getElementById('squadraCasa'),
                document.getElementById('squadraOspite')
            ];
            
            selects.forEach(select => {
                if(!select) return;
                
                const valoreSalvato = select.value;
                
                // Pulisci le opzioni (mantenendo la prima)
                while(select.options.length > 1) {
                    select.remove(1);
                }
                
                // Aggiungi le squadre
                database.squadre.forEach(squadra => {
                    const option = document.createElement('option');
                    option.value = squadra.nome;
                    option.textContent = squadra.nome;
                    select.appendChild(option);
                });
                
                // Ripristina il valore selezionato se esiste ancora
                if(valoreSalvato && database.squadre.some(s => s.nome === valoreSalvato)) {
                    select.value = valoreSalvato;
                }
            });
        }
        
        // Aggiungi squadra
        function aggiungiSquadra() {
            const nome = document.getElementById('nomeSquadra').value.trim();
            const allenatore = document.getElementById('allenatore').value.trim();
            const colori = document.getElementById('colori').value.trim();
            
            if(!nome) {
                alert("Inserisci il nome della squadra!");
                return;
            }
            
            if(database.squadre.some(s => s.nome.toLowerCase() === nome.toLowerCase())) {
                alert(`La squadra "${nome}" esiste gi√†!`);
                return;
            }
            
            const nuovaSquadra = {
                id: Date.now(),
                nome: nome,
                allenatore: allenatore || "Non specificato",
                colori: colori || "Non specificati",
                punti: 0,
                partiteGiocate: 0,
                vittorie: 0,
                pareggi: 0,
                sconfitte: 0,
                golFatti: 0,
                golSubiti: 0
            };
            
            database.squadre.push(nuovaSquadra);
            salvaDatabase();
            caricaSquadreNeiSelect();
            
            document.getElementById('nomeSquadra').value = '';
            document.getElementById('allenatore').value = '';
            document.getElementById('colori').value = '';
            
            alert(`Squadra "${nome}" aggiunta con successo!`);
        }
        
        // Aggiungi giocatore
        function aggiungiGiocatore() {
            const squadra = document.getElementById('squadraGiocatore').value;
            const nome = document.getElementById('nomeGiocatore').value.trim();
            const numero = document.getElementById('numeroMaglia').value;
            const ruolo = document.getElementById('ruolo').value;
            
            if(!squadra || !nome) {
                alert("Compila tutti i campi obbligatori!");
                return;
            }
            
            const nuovoGiocatore = {
                id: Date.now(),
                nome: nome,
                numero: numero || null,
                ruolo: ruolo,
                squadra: squadra,
                gol: 0,
                ammonizioni: 0,
                espulsioni: 0,
                punteggioTotale: 0  // Somma di tutti i voti
            };
            
            database.giocatori.push(nuovoGiocatore);
            salvaDatabase();
            
            document.getElementById('nomeGiocatore').value = '';
            document.getElementById('numeroMaglia').value = '';
            
            alert(`Giocatore "${nome}" aggiunto alla squadra ${squadra}!`);
        }
        
        // Carica giocatori per squadra
        function caricaGiocatoriSquadra(tipo) {
            const squadraSelect = tipo === 'casa' 
                ? document.getElementById('squadraCasa') 
                : document.getElementById('squadraOspite');
            
            const containerId = tipo === 'casa' 
                ? 'giocatoriCasaContainer' 
                : 'giocatoriOspiteContainer';
            
            const giocatoriDivId = tipo === 'casa' 
                ? 'giocatoriCasa' 
                : 'giocatoriOspite';
            
            const squadra = squadraSelect.value;
            
            if(!squadra) {
                document.getElementById(containerId).classList.add('hidden');
                return;
            }
            
            // Filtra giocatori della squadra
            const giocatoriSquadra = database.giocatori.filter(g => g.squadra === squadra);
            
            let html = '';
            if(giocatoriSquadra.length === 0) {
                html = '<p class="avviso">Nessun giocatore registrato per questa squadra</p>';
            } else {
                giocatoriSquadra.forEach(giocatore => {
                    html += `
                        <div class="giocatore-eventi">
                            <div class="giocatore-header">
                                <div>
                                    <strong>${giocatore.nome}</strong>
                                    <small>(${giocatore.ruolo} #${giocatore.numero || 'N/A'})</small>
                                </div>
                                <div class="contatori">
                                    <div class="contatore">
                                        <button class="btn-contatore gol-segnati" onclick="modificaContatore('${tipo}', ${giocatore.id}, 'gol', -1)">-</button>
                                        <span class="valore-contatore" id="gol-${giocatore.id}">0</span>
                                        <button class="btn-contatore gol-segnati" onclick="modificaContatore('${tipo}', ${giocatore.id}, 'gol', 1)">+</button>
                                        <span>‚öΩ</span>
                                    </div>
                                    <div class="contatore">
                                        <button class="btn-contatore ammonizioni" onclick="modificaContatore('${tipo}', ${giocatore.id}, 'amm', -1)">-</button>
                                        <span class="valore-contatore" id="amm-${giocatore.id}">0</span>
                                        <button class="btn-contatore ammonizioni" onclick="modificaContatore('${tipo}', ${giocatore.id}, 'amm', 1)">+</button>
                                        <span>üü®</span>
                                    </div>
                                    <div class="contatore">
                                        <button class="btn-contatore espulsioni" onclick="modificaContatore('${tipo}', ${giocatore.id}, 'esp', -1)">-</button>
                                        <span class="valore-contatore" id="esp-${giocatore.id}">0</span>
                                        <button class="btn-contatore espulsioni" onclick="modificaContatore('${tipo}', ${giocatore.id}, 'esp', 1)">+</button>
                                        <span>üü•</span>
                                    </div>
                                </div>
                            </div>
                            <div class="voto-container">
                                <label>Voto (1-10):</label>
                                <div class="voto-stelle" id="voto-${giocatore.id}">
                                    ${[1,2,3,4,5,6,7,8,9,10].map(v => 
                                        `<span class="stella" onclick="assegnaVoto('${tipo}', ${giocatore.id}, ${v})">‚òÖ</span>`
                                    ).join('')}
                                </div>
                                <span>Voto attuale: <span id="voto-attuale-${giocatore.id}">N/A</span></span>
                            </div>
                        </div>
                    `;
                });
            }
            
            document.getElementById(giocatoriDivId).innerHTML = html;
            document.getElementById(containerId).classList.remove('hidden');
            
            // Mostra container eventi se entrambe le squadre sono selezionate
            const squadraCasa = document.getElementById('squadraCasa').value;
            const squadraOspite = document.getElementById('squadraOspite').value;
            if(squadraCasa && squadraOspite) {
                document.getElementById('eventiSalvatiContainer').classList.remove('hidden');
                aggiornaEventiSalvati();
            }
        }
        
        // Modifica contatori gol/amm/esp
        function modificaContatore(tipoSquadra, giocatoreId, tipo, modifica) {
            const elemento = document.getElementById(`${tipo}-${giocatoreId}`);
            let valore = parseInt(elemento.textContent) || 0;
            
            // Calcola nuovo valore
            let nuovoValore = valore + modifica;
            
            // Non permettere valori negativi
            if(nuovoValore < 0) nuovoValore = 0;
            
            // Controllo speciale per i gol: non superare i gol totali della partita
            if(tipo === 'gol') {
                const golCasa = parseInt(document.getElementById('golCasa').value) || 0;
                const golOspite = parseInt(document.getElementById('golOspite').value) || 0;
                const golTotaliPartita = tipoSquadra === 'casa' ? golCasa : golOspite;
                
                // Calcola gol gi√† assegnati a tutti i giocatori di questa squadra
                let golAssegnati = 0;
                database.giocatori.forEach(g => {
                    const eventiGiocatore = partitaInCorso.eventi.filter(e => 
                        e.giocatoreId === g.id && e.tipo === 'gol'
                    );
                    golAssegnati += eventiGiocatore.length;
                });
                
                if(nuovoValore > golTotaliPartita) {
                    alert(`Non puoi assegnare pi√π gol di quelli segnati dalla squadra! (Massimo: ${golTotaliPartita})`);
                    return;
                }
            }
            
            // Aggiorna visuale
            elemento.textContent = nuovoValore;
            
            // Trova o crea evento
            const eventoEsistenteIndex = partitaInCorso.eventi.findIndex(e => 
                e.giocatoreId === giocatoreId && e.tipo === tipo
            );
            
            if(nuovoValore === 0) {
                // Rimuovi evento se valore √® 0
                if(eventoEsistenteIndex !== -1) {
                    partitaInCorso.eventi.splice(eventoEsistenteIndex, 1);
                }
            } else {
                const giocatore = database.giocatori.find(g => g.id === giocatoreId);
                if(!giocatore) return;
                
                const tipoTesto = tipo === 'gol' ? 'gol' : tipo === 'amm' ? 'ammonizione' : 'espulsione';
                
                if(eventoEsistenteIndex !== -1) {
                    // Aggiorna evento esistente
                    partitaInCorso.eventi[eventoEsistenteIndex].valore = nuovoValore;
                } else {
                    // Crea nuovo evento
                    partitaInCorso.eventi.push({
                        id: Date.now(),
                        giocatoreId: giocatoreId,
                        giocatoreNome: giocatore.nome,
                        tipo: tipo,
                        valore: nuovoValore,
                        squadra: tipoSquadra,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            }
            
            // Aggiorna visualizzazione eventi
            aggiornaEventiSalvati();
            
            // Controlla corrispondenza gol
            controllaCorrispondenzaGol();
        }
        
        // Assegna voto a giocatore
        function assegnaVoto(tipoSquadra, giocatoreId, voto) {
            // Aggiorna stelle
            const stelleDiv = document.getElementById(`voto-${giocatoreId}`);
            const stelle = stelleDiv.querySelectorAll('.stella');
            
            stelle.forEach((stella, index) => {
                if(index < voto) {
                    stella.classList.add('selezionata');
                } else {
                    stella.classList.remove('selezionata');
                }
            });
            
            // Mostra voto attuale
            document.getElementById(`voto-attuale-${giocatoreId}`).textContent = voto;
            
            // Trova o crea evento voto
            const eventoEsistenteIndex = partitaInCorso.eventi.findIndex(e => 
                e.giocatoreId === giocatoreId && e.tipo === 'voto'
            );
            
            const giocatore = database.giocatori.find(g => g.id === giocatoreId);
            
            if(eventoEsistenteIndex !== -1) {
                // Aggiorna evento esistente
                partitaInCorso.eventi[eventoEsistenteIndex].valore = voto;
            } else {
                // Crea nuovo evento
                partitaInCorso.eventi.push({
                    id: Date.now(),
                    giocatoreId: giocatoreId,
                    giocatoreNome: giocatore.nome,
                    tipo: 'voto',
                    valore: voto,
                    squadra: tipoSquadra,
                    timestamp: new Date().toLocaleTimeString()
                });
            }
            
            // Aggiorna visualizzazione eventi
            aggiornaEventiSalvati();
        }
        
        // Controlla corrispondenza gol
        function controllaCorrispondenzaGol() {
            const golCasa = parseInt(document.getElementById('golCasa').value) || 0;
            const golOspite = parseInt(document.getElementById('golOspite').value) || 0;
            
            // Calcola gol assegnati ai giocatori
            let golAssegnatiCasa = 0;
            let golAssegnatiOspite = 0;
            
            partitaInCorso.eventi.forEach(evento => {
                if(evento.tipo === 'gol') {
                    if(evento.squadra === 'casa') {
                        golAssegnatiCasa += evento.valore || 1;
                    } else {
                        golAssegnatiOspite += evento.valore || 1;
                    }
                }
            });
            
            const avviso = document.getElementById('avvisoGol');
            
            if(golAssegnatiCasa !== golCasa || golAssegnatiOspite !== golOspite) {
                avviso.textContent = `‚ö†Ô∏è ATTENZIONE: Gol assegnati non corrispondono al risultato! Casa: ${golAssegnatiCasa}/${golCasa} - Ospite: ${golAssegnatiOspite}/${golOspite}`;
                avviso.classList.add('errore');
            } else {
                avviso.textContent = '‚úÖ Gol assegnati correttamente!';
                avviso.classList.remove('errore');
            }
        }
        
        // Aggiorna eventi salvati
        function aggiornaEventiSalvati() {
            const container = document.getElementById('eventiSalvati');
            
            if(partitaInCorso.eventi.length === 0) {
                container.innerHTML = '<p>Nessun evento registrato</p>';
                return;
            }
            
            let html = '';
            partitaInCorso.eventi.forEach((evento, index) => {
                let icona = '';
                let testo = '';
                
                switch(evento.tipo) {
                    case 'gol':
                        icona = '‚öΩ';
                        testo = `${evento.valore || 1} gol di ${evento.giocatoreNome}`;
                        break;
                    case 'amm':
                        icona = 'üü®';
                        testo = `${evento.valore || 1} ammonizione per ${evento.giocatoreNome}`;
                        break;
                    case 'esp':
                        icona = 'üü•';
                        testo = `${evento.valore || 1} espulsione di ${evento.giocatoreNome}`;
                        break;
                    case 'voto':
                        icona = '‚≠ê';
                        testo = `Voto ${evento.valore}/10 per ${evento.giocatoreNome}`;
                        break;
                }
                
                html += `
                    <div class="evento-item">
                        <span>${icona} ${testo} (${evento.squadra === 'casa' ? 'Casa' : 'Ospite'})</span>
                        <button class="btn-rimuovi" onclick="rimuoviEvento(${index})">Rimuovi</button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            controllaCorrispondenzaGol();
        }
        
        // Rimuovi evento
        function rimuoviEvento(index) {
            const evento = partitaInCorso.eventi[index];
            
            // Resetta contatori visivi
            if(evento.tipo === 'gol') {
                const elemento = document.getElementById(`gol-${evento.giocatoreId}`);
                if(elemento) elemento.textContent = '0';
            } else if(evento.tipo === 'amm') {
                const elemento = document.getElementById(`amm-${evento.giocatoreId}`);
                if(elemento) elemento.textContent = '0';
            } else if(evento.tipo === 'esp') {
                const elemento = document.getElementById(`esp-${evento.giocatoreId}`);
                if(elemento) elemento.textContent = '0';
            } else if(evento.tipo === 'voto') {
                const stelleDiv = document.getElementById(`voto-${evento.giocatoreId}`);
                if(stelleDiv) {
                    const stelle = stelleDiv.querySelectorAll('.stella');
                    stelle.forEach(stella => stella.classList.remove('selezionata'));
                }
                const votoAttuale = document.getElementById(`voto-attuale-${evento.giocatoreId}`);
                if(votoAttuale) votoAttuale.textContent = 'N/A';
            }
            
            // Rimuovi evento
            partitaInCorso.eventi.splice(index, 1);
            aggiornaEventiSalvati();
        }
        
        // Reset partita
        function resetPartita() {
            if(confirm("Vuoi resettare tutti i dati della partita in corso?")) {
                partitaInCorso = {
                    eventi: [],
                    golTotaliCasa: 0,
                    golTotaliOspite: 0
                };
                
                document.getElementById('golCasa').value = 0;
                document.getElementById('golOspite').value = 0;
                document.getElementById('squadraCasa').value = '';
                document.getElementById('squadraOspite').value = '';
                document.getElementById('giocatoriCasaContainer').classList.add('hidden');
                document.getElementById('giocatoriOspiteContainer').classList.add('hidden');
                document.getElementById('eventiSalvatiContainer').classList.add('hidden');
                
                alert("Partita resettata!");
            }
        }
        
        // Salva partita
        function salvaPartita() {
            const squadraCasa = document.getElementById('squadraCasa').value;
            const squadraOspite = document.getElementById('squadraOspite').value;
            const golCasa = parseInt(document.getElementById('golCasa').value) || 0;
            const golOspite = parseInt(document.getElementById('golOspite').value) || 0;
            
            if(!squadraCasa || !squadraOspite) {
                alert("Seleziona entrambe le squadre!");
                return;
            }
            
            if(squadraCasa === squadraOspite) {
                alert("Seleziona due squadre diverse!");
                return;
            }
            
            // Controlla corrispondenza gol
            let golAssegnatiCasa = 0;
            let golAssegnatiOspite = 0;
            
            partitaInCorso.eventi.forEach(evento => {
                if(evento.tipo === 'gol') {
                    if(evento.squadra === 'casa') {
                        golAssegnatiCasa += evento.valore || 1;
                    } else {
                        golAssegnatiOspite += evento.valore || 1;
                    }
                }
            });
            
            if(golAssegnatiCasa !== golCasa || golAssegnatiOspite !== golOspite) {
                alert(`ATTENZIONE: Gol assegnati non corrispondono al risultato!\nCasa: ${golAssegnatiCasa}/${golCasa}\nOspite: ${golAssegnatiOspite}/${golOspite}`);
                return;
            }
            
            // Calcola punti
            let puntiCasa, puntiOspite;
            if(golCasa > golOspite) {
                puntiCasa = 3;
                puntiOspite = 0;
            } else if(golCasa < golOspite) {
                puntiCasa = 0;
                puntiOspite = 3;
            } else {
                puntiCasa = 1;
                puntiOspite = 1;
            }
            
            // Aggiorna statistiche squadre
            database.squadre.forEach(squadra => {
                if(squadra.nome === squadraCasa) {
                    squadra.punti += puntiCasa;
                    squadra.partiteGiocate++;
                    squadra.golFatti += golCasa;
                    squadra.golSubiti += golOspite;
                    if(puntiCasa === 3) squadra.vittorie++;
                    else if(puntiCasa === 1) squadra.pareggi++;
                    else squadra.sconfitte++;
                }
                if(squadra.nome === squadraOspite) {
                    squadra.punti += puntiOspite;
                    squadra.partiteGiocate++;
                    squadra.golFatti += golOspite;
                    squadra.golSubiti += golCasa;
                    if(puntiOspite === 3) squadra.vittorie++;
                    else if(puntiOspite === 1) squadra.pareggi++;
                    else squadra.sconfitte++;
                }
            });
            
            // Aggiorna statistiche giocatori
            partitaInCorso.eventi.forEach(evento => {
                const giocatore = database.giocatori.find(g => g.id === evento.giocatoreId);
                if(!giocatore) return;
                
                switch(evento.tipo) {
                    case 'gol':
                        giocatore.gol = (giocatore.gol || 0) + (evento.valore || 1);
                        break;
                    case 'amm':
                        giocatore.ammonizioni = (giocatore.ammonizioni || 0) + (evento.valore || 1);
                        break;
                    case 'esp':
                        giocatore.espulsioni = (giocatore.espulsioni || 0) + (evento.valore || 1);
                        break;
                    case 'voto':
                        // Aggiungi voto al punteggio totale
                        giocatore.punteggioTotale = (giocatore.punteggioTotale || 0) + evento.valore;
                        break;
                }
            });
            
            // Salva partita
            const nuovaPartita = {
                id: Date.now(),
                data: new Date().toLocaleDateString(),
                ora: new Date().toLocaleTimeString(),
                squadraCasa: squadraCasa,
                squadraOspite: squadraOspite,
                golCasa: golCasa,
                golOspite: golOspite,
                eventi: [...partitaInCorso.eventi]
            };
            
            database.partite.push(nuovaPartita);
            salvaDatabase();
            
            // Reset
            resetPartita();
            
            alert(`Partita salvata con successo!\n${squadraCasa} ${golCasa}-${golOspite} ${squadraOspite}`);
        }
        
        // Funzioni eliminazione dati
        function mostraOpzioniElimina() {
            const tipo = document.getElementById('tipoElimina').value;
            const container = document.getElementById('opzioniElimina');
            const btnElimina = document.getElementById('btnElimina');
            
            if(!tipo) {
                container.classList.add('hidden');
                btnElimina.classList.add('hidden');
                return;
            }
            
            let html = '';
            
            switch(tipo) {
                case 'giocatore':
                    html = `
                        <select id="giocatoreDaEliminare">
                            <option value="">Seleziona giocatore</option>
                            ${database.giocatori.map(g => 
                                `<option value="${g.id}">${g.nome} (${g.squadra})</option>`
                            ).join('')}
                        </select>
                    `;
                    break;
                    
                case 'squadra':
                    html = `
                        <select id="squadraDaEliminare">
                            <option value="">Seleziona squadra</option>
                            ${database.squadre.map(s => 
                                `<option value="${s.id}">${s.nome}</option>`
                            ).join('')}
                        </select>
                        <p><small>Attenzione: Verranno eliminati anche tutti i giocatori della squadra!</small></p>
                    `;
                    break;
                    
                case 'tutto':
                    html = `
                        <div style="background: #ffcccc; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            <h3>‚ö†Ô∏è PERICOLO ‚ö†Ô∏è</h3>
                            <p>Stai per eliminare TUTTI i dati:</p>
                            <ul>
                                <li>${database.squadre.length} squadre</li>
                                <li>${database.giocatori.length} giocatori</li>
                                <li>${database.partite.length} partite</li>
                            </ul>
                            <p>Questa operazione √® IRREVERSIBILE!</p>
                            <label>
                                <input type="checkbox" id="confermaEliminaTutto"> 
                                Confermo di voler eliminare TUTTI i dati
                            </label>
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = html;
            container.classList.remove('hidden');
            btnElimina.classList.remove('hidden');
        }
        
        function eseguiEliminazione() {
            const tipo = document.getElementById('tipoElimina').value;
            
            switch(tipo) {
                case 'giocatore':
                    const giocatoreId = parseInt(document.getElementById('giocatoreDaEliminare').value);
                    if(giocatoreId) {
                        if(confirm("Eliminare questo giocatore?")) {
                            database.giocatori = database.giocatori.filter(g => g.id !== giocatoreId);
                            salvaDatabase();
                            alert("Giocatore eliminato!");
                            mostraOpzioniElimina();
                        }
                    }
                    break;
                    
                case 'squadra':
                    const squadraId = parseInt(document.getElementById('squadraDaEliminare').value);
                    if(squadraId) {
                        if(confirm("ATTENZIONE: Eliminando una squadra verranno eliminati anche tutti i suoi giocatori. Continuare?")) {
                            // Trova nome squadra
                            const squadra = database.squadre.find(s => s.id === squadraId);
                            if(!squadra) return;
                            
                            // Elimina squadra
                            database.squadre = database.squadre.filter(s => s.id !== squadraId);
                            
                            // Elimina giocatori della squadra
                            database.giocatori = database.giocatori.filter(g => g.squadra !== squadra.nome);
                            
                            salvaDatabase();
                            caricaSquadreNeiSelect();
                            alert("Squadra e giocatori eliminati!");
                            mostraOpzioniElimina();
                        }
                    }
                    break;
                    
                case 'tutto':
                    const conferma = document.getElementById('confermaEliminaTutto');
                    if(!conferma || !conferma.checked) {
                        alert("Devi selezionare la casella di conferma!");
                        return;
                    }
                    
                    if(confirm("‚ö†Ô∏è SEI SICURO DI VOLER ELIMINARE TUTTI I DATI? ‚ö†Ô∏è\nQuesta operazione non pu√≤ essere annullata!")) {
                        database = { squadre: [], giocatori: [], partite: [] };
                        salvaDatabase();
                        caricaSquadreNeiSelect();
                        alert("Tutti i dati sono stati eliminati!");
                        document.getElementById('tipoElimina').value = '';
                        document.getElementById('opzioniElimina').innerHTML = '';
                        document.getElementById('opzioniElimina').classList.add('hidden');
                        document.getElementById('btnElimina').classList.add('hidden');
                    }
                    break;
            }
        }
        
        // Salva nel localStorage
        function salvaDatabase() {
            localStorage.setItem('rovigoal_squadre', JSON.stringify(database.squadre));
            localStorage.setItem('rovigoal_giocatori', JSON.stringify(database.giocatori));
            localStorage.setItem('rovigoal_partite', JSON.stringify(database.partite));
        }
        
        // Controllo password all'entrata
        if(!localStorage.getItem('admin_accesso') || localStorage.getItem('admin_accesso') !== 'true') {
            const password = prompt("Inserisci la password ADMIN:");
            if(password !== "1246912.!!") {
                alert("Accesso negato!");
                window.location.href = 'main.html';
            } else {
                localStorage.setItem('admin_accesso', 'true');
            }
        }
    </script>
</body>
</html>

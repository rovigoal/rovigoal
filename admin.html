<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rovigoal - Area Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #f0f2f5;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #FF4500 0%, #DC143C 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 30px;
            background: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .tab-btn:hover {
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: #1e3c72;
            color: white;
        }
        
        .tab-content {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .tab-content.active {
            display: grid;
        }
        
        .sezione {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #FF4500;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .btn {
            background: linear-gradient(135deg, #FF4500 0%, #DC143C 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-full {
            width: 100%;
        }
        
        .btn-back {
            background: #1e3c72;
            margin: 20px auto;
            display: block;
            padding: 12px 30px;
        }
        
        .btn-green {
            background: linear-gradient(135deg, #32CD32 0%, #228B22 100%);
        }
        
        .btn-blue {
            background: linear-gradient(135deg, #1E90FF 0%, #4169E1 100%);
        }
        
        .btn-red {
            background: linear-gradient(135deg, #FF0000 0%, #DC143C 100%);
        }
        
        .lista {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
        }
        
        .item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .item:last-child {
            border-bottom: none;
        }
        
        .badge {
            background: #FF4500;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .badge-gol {
            background: #32CD32;
        }
        
        .badge-amm {
            background: #FFD700;
            color: #333;
        }
        
        .badge-esp {
            background: #DC143C;
        }
        
        .badge-voto {
            background: #8A2BE2;
        }
        
        .giocatore-info {
            flex: 1;
        }
        
        .giocatore-nome {
            font-weight: bold;
        }
        
        .giocatore-dettagli {
            font-size: 0.9em;
            color: #666;
        }
        
        .azioni {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 3px;
            border: none;
            cursor: pointer;
            color: white;
        }
        
        .btn-modifica {
            background: #1E90FF;
        }
        
        .btn-elimina {
            background: #DC143C;
        }
        
        .sezione-elimina {
            grid-column: 1 / -1;
            background: #fff5f5;
            border: 2px solid #ffcccc;
        }
        
        .voto-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .voto-stelle {
            display: flex;
            gap: 5px;
        }
        
        .stella {
            font-size: 24px;
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s;
        }
        
        .stella.selezionata {
            color: #FFD700;
        }
        
        .player-events {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            background: #f9f9f9;
        }
        
        .player-event-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .player-event-item:last-child {
            border-bottom: none;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß AREA ADMIN ROVIGOAL</h1>
        <p>Gestione completa del torneo</p>
    </div>
    
    <div class="tabs">
        <button class="tab-btn active" onclick="apriTab('gestione')">üë• GESTIONE SQUADRE & GIOCATORI</button>
        <button class="tab-btn" onclick="apriTab('partite')">‚öΩ GESTIONE PARTITE</button>
        <button class="tab-btn" onclick="apriTab('elimina')">üóëÔ∏è ELIMINA DATI</button>
    </div>
    
    <!-- TAB 1: GESTIONE SQUADRE E GIOCATORI -->
    <div id="gestione" class="tab-content active">
        <!-- SEZIONE AGGIUNGI SQUADRA -->
        <div class="sezione">
            <h2>‚ûï AGGIUNGI SQUADRA</h2>
            <div class="form-group">
                <label>Nome Squadra:</label>
                <input type="text" id="nomeSquadra" placeholder="Es: Rovigo FC">
            </div>
            <div class="form-group">
                <label>Allenatore:</label>
                <input type="text" id="allenatore" placeholder="Nome allenatore">
            </div>
            <div class="form-group">
                <label>Colori:</label>
                <input type="text" id="colori" placeholder="Es: Rosso-Blu">
            </div>
            <button class="btn btn-green btn-full" onclick="aggiungiSquadra()">AGGIUNGI SQUADRA</button>
        </div>
        
        <!-- SEZIONE AGGIUNGI GIOCATORE -->
        <div class="sezione">
            <h2>üë• AGGIUNGI GIOCATORE</h2>
            <div class="form-group">
                <label>Squadra:</label>
                <select id="squadraGiocatore">
                    <option value="">Seleziona squadra</option>
                </select>
            </div>
            <div class="form-group">
                <label>Nome Giocatore:</label>
                <input type="text" id="nomeGiocatore" placeholder="Nome e cognome">
            </div>
            <div class="form-group">
                <label>Numero Maglia:</label>
                <input type="number" id="numeroMaglia" placeholder="Es: 10">
            </div>
            <div class="form-group">
                <label>Ruolo:</label>
                <select id="ruolo">
                    <option value="Portiere">Portiere</option>
                    <option value="Difensore">Difensore</option>
                    <option value="Centrocampista">Centrocampista</option>
                    <option value="Attaccante">Attaccante</option>
                </select>
            </div>
            <button class="btn btn-blue btn-full" onclick="aggiungiGiocatore()">AGGIUNGI GIOCATORE</button>
        </div>
        
        <!-- SEZIONE ELENCHI -->
        <div class="sezione" style="grid-column: span 2;">
            <h2>üìã ELENCHI</h2>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button class="btn btn-green" onclick="mostraSquadre()">VISUALIZZA SQUADRE</button>
                <button class="btn btn-blue" onclick="mostraGiocatori()">VISUALIZZA GIOCATORI</button>
                <button class="btn" onclick="mostraPartite()">VISUALIZZA PARTITE</button>
            </div>
            
            <div class="lista" id="listaDati">
                <!-- Qui appariranno i dati -->
            </div>
        </div>
    </div>
    
    <!-- TAB 2: GESTIONE PARTITE -->
    <div id="partite" class="tab-content">
        <!-- SEZIONE INSERISCI RISULTATO -->
        <div class="sezione">
            <h2>‚öΩ INSERISCI RISULTATO PARTITA</h2>
            <div class="form-group">
                <label>Squadra Casa:</label>
                <select id="squadraCasa" onchange="caricaGiocatoriSquadra('casa')">
                    <option value="">Seleziona squadra</option>
                </select>
            </div>
            <div class="form-group">
                <label>Squadra Ospite:</label>
                <select id="squadraOspite" onchange="caricaGiocatoriSquadra('ospite')">
                    <option value="">Seleziona squadra</option>
                </select>
            </div>
            <div class="form-group">
                <label>Gol Casa:</label>
                <input type="number" id="golCasa" min="0" value="0" onchange="aggiornaGolTotali()">
            </div>
            <div class="form-group">
                <label>Gol Ospite:</label>
                <input type="number" id="golOspite" min="0" value="0" onchange="aggiornaGolTotali()">
            </div>
            
            <div id="giocatoriCasaContainer" class="hidden">
                <h3>Giocatori Squadra Casa</h3>
                <div id="giocatoriCasa"></div>
            </div>
            
            <div id="giocatoriOspiteContainer" class="hidden">
                <h3>Giocatori Squadra Ospite</h3>
                <div id="giocatoriOspite"></div>
            </div>
            
            <button class="btn btn-full" onclick="inserisciRisultatoCompleto()">SALVA RISULTATO COMPLETO</button>
        </div>
        
        <!-- SEZIONE EVENTI PARTITA -->
        <div class="sezione">
            <h2>üéØ EVENTI PARTITA</h2>
            <div class="lista" id="eventiPartita">
                <!-- Gli eventi verranno aggiunti qui -->
            </div>
        </div>
    </div>
    
    <!-- TAB 3: ELIMINA DATI -->
    <div id="elimina" class="tab-content">
        <div class="sezione sezione-elimina">
            <h2>‚ö†Ô∏è ELIMINA DATI</h2>
            <p><strong>Attenzione:</strong> Queste azioni sono irreversibili!</p>
            
            <div class="form-group">
                <label>Seleziona cosa eliminare:</label>
                <select id="tipoElimina">
                    <option value="">Seleziona...</option>
                    <option value="giocatore">Elimina Giocatore</option>
                    <option value="squadra">Elimina Squadra</option>
                    <option value="partita">Elimina Partita</option>
                    <option value="tutto">Elimina TUTTO</option>
                </select>
            </div>
            
            <div id="selezioneElimina" class="hidden">
                <!-- Qui appariranno le opzioni specifiche -->
            </div>
            
            <button class="btn btn-red btn-full" onclick="eseguiEliminazione()" style="margin-top: 20px;">
                üóëÔ∏è ELIMINA
            </button>
        </div>
        
        <div class="sezione">
            <h2>üìä STATISTICHE DATI</h2>
            <div class="lista">
                <div class="item">
                    <span>Squadre registrate:</span>
                    <span class="badge" id="statSquadre">0</span>
                </div>
                <div class="item">
                    <span>Giocatori registrati:</span>
                    <span class="badge" id="statGiocatori">0</span>
                </div>
                <div class="item">
                    <span>Partite giocate:</span>
                    <span class="badge" id="statPartite">0</span>
                </div>
                <div class="item">
                    <span>Gol totali:</span>
                    <span class="badge" id="statGol">0</span>
                </div>
            </div>
        </div>
    </div>
    
    <button class="btn btn-back" onclick="tornaIndietro()">‚Üê TORNA ALLA HOME</button>
    
    <script>
        // Database in memoria
        let database = {
            squadre: JSON.parse(localStorage.getItem('rovigoal_squadre')) || [],
            giocatori: JSON.parse(localStorage.getItem('rovigoal_giocatori')) || [],
            partite: JSON.parse(localStorage.getItem('rovigoal_partite')) || []
        };
        
        // Variabili temporanee per la partita in corso
        let partitaInCorso = {
            eventi: [],
            giocatoriCasa: [],
            giocatoriOspite: []
        };
        
        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            caricaSquadreNeiSelect();
            caricaStatisticheElimina();
        });
        
        // Funzione per cambiare tab
        function apriTab(tabName) {
            // Nascondi tutti i tab
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Rimuovi active da tutti i tab buttons
            document.querySelectorAll('.tab-btn').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostra il tab selezionato
            document.getElementById(tabName).classList.add('active');
            
            // Attiva il button del tab
            event.target.classList.add('active');
            
            // Se √® il tab elimina, carica le statistiche
            if(tabName === 'elimina') {
                caricaStatisticheElimina();
                document.getElementById('tipoElimina').value = '';
                document.getElementById('selezioneElimina').innerHTML = '';
                document.getElementById('selezioneElimina').classList.add('hidden');
            }
            
            // Se √® il tab partite, resetta
            if(tabName === 'partite') {
                partitaInCorso = { eventi: [], giocatoriCasa: [], giocatoriOspite: [] };
                document.getElementById('eventiPartita').innerHTML = '<p>Nessun evento registrato</p>';
            }
        }
        
        // Carica squadre nei select
        function caricaSquadreNeiSelect() {
            const selects = [
                document.getElementById('squadraGiocatore'),
                document.getElementById('squadraCasa'),
                document.getElementById('squadraOspite')
            ];
            
            selects.forEach(select => {
                if(!select) return;
                
                // Salva il valore selezionato
                const valoreSalvato = select.value;
                
                // Pulisci le opzioni (mantenendo la prima)
                while(select.options.length > 1) {
                    select.remove(1);
                }
                
                // Aggiungi le squadre
                database.squadre.forEach(squadra => {
                    const option = document.createElement('option');
                    option.value = squadra.nome;
                    option.textContent = squadra.nome;
                    select.appendChild(option);
                });
                
                // Ripristina il valore selezionato se esiste ancora
                if(valoreSalvato && database.squadre.some(s => s.nome === valoreSalvato)) {
                    select.value = valoreSalvato;
                }
            });
        }
        
        // Funzioni per aggiungere dati
        function aggiungiSquadra() {
            const nome = document.getElementById('nomeSquadra').value.trim();
            const allenatore = document.getElementById('allenatore').value.trim();
            const colori = document.getElementById('colori').value.trim();
            
            if(!nome) {
                alert("Inserisci il nome della squadra!");
                return;
            }
            
            // Controlla se la squadra esiste gi√†
            if(database.squadre.some(s => s.nome.toLowerCase() === nome.toLowerCase())) {
                alert(`La squadra "${nome}" esiste gi√†!`);
                return;
            }
            
            const nuovaSquadra = {
                id: Date.now(),
                nome: nome,
                allenatore: allenatore || "Non specificato",
                colori: colori || "Non specificati",
                punti: 0,
                partiteGiocate: 0,
                vittorie: 0,
                pareggi: 0,
                sconfitte: 0,
                golFatti: 0,
                golSubiti: 0
            };
            
            database.squadre.push(nuovaSquadra);
            salvaDatabase();
            caricaSquadreNeiSelect();
            
            document.getElementById('nomeSquadra').value = '';
            document.getElementById('allenatore').value = '';
            document.getElementById('colori').value = '';
            
            alert(`Squadra "${nome}" aggiunta con successo!`);
        }
        
        function aggiungiGiocatore() {
            const squadra = document.getElementById('squadraGiocatore').value;
            const nome = document.getElementById('nomeGiocatore').value.trim();
            const numero = document.getElementById('numeroMaglia').value;
            const ruolo = document.getElementById('ruolo').value;
            
            if(!squadra || !nome) {
                alert("Compila tutti i campi obbligatori!");
                return;
            }
            
            const nuovoGiocatore = {
                id: Date.now(),
                nome: nome,
                numero: numero || null,
                ruolo: ruolo,
                squadra: squadra,
                gol: 0,
                ammonizioni: 0,
                espulsioni: 0,
                voti: [],
                mediaVoto: 0
            };
            
            database.giocatori.push(nuovoGiocatore);
            salvaDatabase();
            
            document.getElementById('nomeGiocatore').value = '';
            document.getElementById('numeroMaglia').value = '';
            
            alert(`Giocatore "${nome}" aggiunto alla squadra ${squadra}!`);
        }
        
        // Carica giocatori per squadra (per partita)
        function caricaGiocatoriSquadra(tipo) {
            const squadraSelect = tipo === 'casa' 
                ? document.getElementById('squadraCasa') 
                : document.getElementById('squadraOspite');
            
            const containerId = tipo === 'casa' 
                ? 'giocatoriCasaContainer' 
                : 'giocatoriOspiteContainer';
            
            const giocatoriDivId = tipo === 'casa' 
                ? 'giocatoriCasa' 
                : 'giocatoriOspite';
            
            const squadra = squadraSelect.value;
            
            if(!squadra) {
                document.getElementById(containerId).classList.add('hidden');
                return;
            }
            
            // Filtra giocatori della squadra
            const giocatoriSquadra = database.giocatori.filter(g => g.squadra === squadra);
            
            let html = '';
            if(giocatoriSquadra.length === 0) {
                html = '<p>Nessun giocatore registrato per questa squadra</p>';
            } else {
                giocatoriSquadra.forEach(giocatore => {
                    html += `
                        <div class="player-events">
                            <div class="player-event-item">
                                <div>
                                    <strong>${giocatore.nome}</strong>
                                    <small>(${giocatore.ruolo} #${giocatore.numero || 'N/A'})</small>
                                </div>
                                <div>
                                    <button onclick="aggiungiEvento('${tipo}', ${giocatore.id}, 'gol')">‚öΩ Gol</button>
                                    <button onclick="aggiungiEvento('${tipo}', ${giocatore.id}, 'ammonizione')">üü® Ammonizione</button>
                                    <button onclick="aggiungiEvento('${tipo}', ${giocatore.id}, 'espulsione')">üü• Espulsione</button>
                                </div>
                            </div>
                            <div class="voto-container">
                                <span>Voto:</span>
                                <div class="voto-stelle" id="voto-${giocatore.id}">
                                    ${[1,2,3,4,5,6,7,8,9,10].map(v => 
                                        `<span class="stella" onclick="assegnaVoto(${giocatore.id}, ${v})">‚òÖ</span>`
                                    ).join('')}
                                </div>
                                <span id="voto-attuale-${giocatore.id}"></span>
                            </div>
                        </div>
                    `;
                });
            }
            
            document.getElementById(giocatoriDivId).innerHTML = html;
            document.getElementById(containerId).classList.remove('hidden');
            
            // Salva i giocatori per la partita in corso
            if(tipo === 'casa') {
                partitaInCorso.giocatoriCasa = giocatoriSquadra;
            } else {
                partitaInCorso.giocatoriOspite = giocatoriSquadra;
            }
        }
        
        // Aggiungi evento a un giocatore
        function aggiungiEvento(tipoSquadra, giocatoreId, tipoEvento) {
            const giocatore = database.giocatori.find(g => g.id === giocatoreId);
            if(!giocatore) return;
            
            // Crea evento
            const evento = {
                id: Date.now(),
                giocatoreId: giocatoreId,
                giocatoreNome: giocatore.nome,
                tipo: tipoEvento,
                squadra: tipoSquadra,
                timestamp: new Date().toLocaleTimeString()
            };
            
            // Aggiungi alla partita in corso
            partitaInCorso.eventi.push(evento);
            
            // Aggiorna visualizzazione
            aggiornaEventiPartita();
        }
        
        // Assegna voto a giocatore
        function assegnaVoto(giocatoreId, voto) {
            // Aggiorna stelle
            const stelleDiv = document.getElementById(`voto-${giocatoreId}`);
            const stelle = stelleDiv.querySelectorAll('.stella');
            
            stelle.forEach((stella, index) => {
                if(index < voto) {
                    stella.classList.add('selezionata');
                } else {
                    stella.classList.remove('selezionata');
                }
            });
            
            // Mostra voto attuale
            document.getElementById(`voto-attuale-${giocatoreId}`).textContent = `Voto: ${voto}/10`;
            
            // Salva voto temporaneo per la partita
            const eventoEsistente = partitaInCorso.eventi.find(e => 
                e.giocatoreId === giocatoreId && e.tipo === 'voto'
            );
            
            if(eventoEsistente) {
                eventoEsistente.valore = voto;
            } else {
                const giocatore = database.giocatori.find(g => g.id === giocatoreId);
                partitaInCorso.eventi.push({
                    id: Date.now(),
                    giocatoreId: giocatoreId,
                    giocatoreNome: giocatore.nome,
                    tipo: 'voto',
                    valore: voto,
                    squadra: giocatore.squadra === document.getElementById('squadraCasa').value ? 'casa' : 'ospite',
                    timestamp: new Date().toLocaleTimeString()
                });
            }
            
            aggiornaEventiPartita();
        }
        
        // Aggiorna visualizzazione eventi partita
        function aggiornaEventiPartita() {
            const container = document.getElementById('eventiPartita');
            
            if(partitaInCorso.eventi.length === 0) {
                container.innerHTML = '<p>Nessun evento registrato</p>';
                return;
            }
            
            let html = '<h3>Eventi Registrati:</h3>';
            partitaInCorso.eventi.forEach(evento => {
                let icona = '';
                let testo = '';
                
                switch(evento.tipo) {
                    case 'gol':
                        icona = '‚öΩ';
                        testo = `Gol di ${evento.giocatoreNome}`;
                        break;
                    case 'ammonizione':
                        icona = 'üü®';
                        testo = `Ammonizione per ${evento.giocatoreNome}`;
                        break;
                    case 'espulsione':
                        icona = 'üü•';
                        testo = `Espulsione di ${evento.giocatoreNome}`;
                        break;
                    case 'voto':
                        icona = '‚≠ê';
                        testo = `Voto ${evento.valore}/10 per ${evento.giocatoreNome}`;
                        break;
                }
                
                html += `
                    <div class="player-event-item">
                        <span>${icona} ${testo}</span>
                        <span class="badge">${evento.timestamp}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Inserisci risultato completo con eventi
        function inserisciRisultatoCompleto() {
            const squadraCasa = document.getElementById('squadraCasa').value;
            const squadraOspite = document.getElementById('squadraOspite').value;
            const golCasa = parseInt(document.getElementById('golCasa').value) || 0;
            const golOspite = parseInt(document.getElementById('golOspite').value) || 0;
            
            if(!squadraCasa || !squadraOspite) {
                alert("Seleziona entrambe le squadre!");
                return;
            }
            
            if(squadraCasa === squadraOspite) {
                alert("Seleziona due squadre diverse!");
                return;
            }
            
            // Calcola punti
            let puntiCasa, puntiOspite;
            if(golCasa > golOspite) {
                puntiCasa = 3;
                puntiOspite = 0;
            } else if(golCasa < golOspite) {
                puntiCasa = 0;
                puntiOspite = 3;
            } else {
                puntiCasa = 1;
                puntiOspite = 1;
            }
            
            // Aggiorna statistiche squadre
            database.squadre.forEach(squadra => {
                if(squadra.nome === squadraCasa) {
                    squadra.punti += puntiCasa;
                    squadra.partiteGiocate++;
                    squadra.golFatti += golCasa;
                    squadra.golSubiti += golOspite;
                    if(puntiCasa === 3) squadra.vittorie++;
                    else if(puntiCasa === 1) squadra.pareggi++;
                    else squadra.sconfitte++;
                }
                if(squadra.nome === squadraOspite) {
                    squadra.punti += puntiOspite;
                    squadra.partiteGiocate++;
                    squadra.golFatti += golOspite;
                    squadra.golSubiti += golCasa;
                    if(puntiOspite === 3) squadra.vittorie++;
                    else if(puntiOspite === 1) squadra.pareggi++;
                    else squadra.sconfitte++;
                }
            });
            
            // Aggiorna statistiche giocatori dagli eventi
            partitaInCorso.eventi.forEach(evento => {
                const giocatore = database.giocatori.find(g => g.id === evento.giocatoreId);
                if(!giocatore) return;
                
                switch(evento.tipo) {
                    case 'gol':
                        giocatore.gol = (giocatore.gol || 0) + 1;
                        break;
                    case 'ammonizione':
                        giocatore.ammonizioni = (giocatore.ammonizioni || 0) + 1;
                        break;
                    case 'espulsione':
                        giocatore.espulsioni = (giocatore.espulsioni || 0) + 1;
                        break;
                    case 'voto':
                        // Aggiungi voto all'array voti
                        giocatore.voti = giocatore.voti || [];
                        giocatore.voti.push(evento.valore);
                        
                        // Calcola nuova media
                        const sommaVoti = giocatore.voti.reduce((a, b) => a + b, 0);
                        giocatore.mediaVoto = sommaVoti / giocatore.voti.length;
                        break;
                }
            });
            
            // Salva partita
            const nuovaPartita = {
                id: Date.now(),
                data: new Date().toLocaleDateString(),
                ora: new Date().toLocaleTimeString(),
                squadraCasa: squadraCasa,
                squadraOspite: squadraOspite,
                golCasa: golCasa,
                golOspite: golOspite,
                eventi: [...partitaInCorso.eventi]
            };
            
            database.partite.push(nuovaPartita);
            salvaDatabase();
            
            // Reset form
            document.getElementById('golCasa').value = 0;
            document.getElementById('golOspite').value = 0;
            document.getElementById('giocatoriCasaContainer').classList.add('hidden');
            document.getElementById('giocatoriOspiteContainer').classList.add('hidden');
            document.getElementById('squadraCasa').value = '';
            document.getElementById('squadraOspite').value = '';
            partitaInCorso = { eventi: [], giocatoriCasa: [], giocatoriOspite: [] };
            document.getElementById('eventiPartita').innerHTML = '<p>Nessun evento registrato</p>';
            
            alert(`Partita registrata con successo!\n${squadraCasa} ${golCasa}-${golOspite} ${squadraOspite}`);
        }
        
        // Funzioni per visualizzare dati
        function mostraSquadre() {
            const lista = document.getElementById('listaDati');
            
            if(database.squadre.length === 0) {
                lista.innerHTML = '<p class="item">Nessuna squadra registrata</p>';
                return;
            }
            
            let html = '<h3>Squadre Registrate:</h3>';
            database.squadre.forEach(squadra => {
                const dr = squadra.golFatti - squadra.golSubiti;
                html += `
                    <div class="item">
                        <div class="giocatore-info">
                            <div class="giocatore-nome">${squadra.nome}</div>
                            <div class="giocatore-dettagli">
                                ${squadra.allenatore} | ${squadra.colori}
                            </div>
                        </div>
                        <div class="azioni">
                            <span class="badge">${squadra.punti} PTS</span>
                            <button class="btn-small btn-elimina" onclick="eliminaSquadra(${squadra.id})">Elimina</button>
                        </div>
                    </div>
                `;
            });
            lista.innerHTML = html;
        }
        
        function mostraGiocatori() {
            const lista = document.getElementById('listaDati');
            
            if(database.giocatori.length === 0) {
                lista.innerHTML = '<p class="item">Nessun giocatore registrato</p>';
                return;
            }
            
            let html = '<h3>Giocatori Registrati:</h3>';
            database.giocatori.forEach(giocatore => {
                let badges = '';
                if(giocatore.gol > 0) badges += `<span class="badge badge-gol">‚öΩ ${giocatore.gol}</span> `;
                if(giocatore.ammonizioni > 0) badges += `<span class="badge badge-amm">üü® ${giocatore.ammonizioni}</span> `;
                if(giocatore.espulsioni > 0) badges += `<span class="badge badge-esp">üü• ${giocatore.espulsioni}</span> `;
                if(giocatore.mediaVoto > 0) badges += `<span class="badge badge-voto">‚≠ê ${giocatore.mediaVoto.toFixed(1)}</span>`;
                
                html += `
                    <div class="item">
                        <div class="giocatore-info">
                            <div class="giocatore-nome">
                                ${giocatore.nome} 
                                ${giocatore.numero ? `(#${giocatore.numero})` : ''}
                            </div>
                            <div class="giocatore-dettagli">
                                ${giocatore.squadra} - ${giocatore.ruolo}
                            </div>
                        </div>
                        <div class="azioni">
                            ${badges}
                            <button class="btn-small btn-elimina" onclick="eliminaGiocatore(${giocatore.id})">Elimina</button>
                        </div>
                    </div>
                `;
            });
            lista.innerHTML = html;
        }
        
        function mostraPartite() {
            const lista = document.getElementById('listaDati');
            
            if(database.partite.length === 0) {
                lista.innerHTML = '<p class="item">Nessuna partita registrata</p>';
                return;
            }
            
            let html = '<h3>Partite Giocate:</h3>';
            // Mostra le ultime 10 partite (pi√π recenti prima)
            const partiteRecent = [...database.partite].reverse().slice(0, 10);
            
            partiteRecent.forEach(partita => {
                html += `
                    <div class="item">
                        <div>
                            <strong>${partita.squadraCasa} ${partita.golCasa}-${partita.golOspite} ${partita.squadraOspite}</strong><br>
                            <small>${partita.data} ${partita.ora}</small>
                        </div>
                        <div class="azioni">
                            <button class="btn-small btn-elimina" onclick="eliminaPartita(${partita.id})">Elimina</button>
                        </div>
                    </div>
                `;
            });
            lista.innerHTML = html;
        }
        
        // Funzioni di eliminazione
        function eliminaSquadra(id) {
            if(confirm("ATTENZIONE: Eliminando una squadra verranno eliminati anche tutti i suoi giocatori. Continuare?")) {
                // Elimina la squadra
                database.squadre = database.squadre.filter(s => s.id !== id);
                
                // Elimina tutti i giocatori della squadra
                database.giocatori = database.giocatori.filter(g => {
                    const squadraGiocatore = database.squadre.find(s => s.nome === g.squadra);
                    return squadraGiocatore !== undefined;
                });
                
                salvaDatabase();
                caricaSquadreNeiSelect();
                alert("Squadra e giocatori eliminati con successo!");
                mostraSquadre();
            }
        }
        
        function eliminaGiocatore(id) {
            if(confirm("Eliminare questo giocatore?")) {
                database.giocatori = database.giocatori.filter(g => g.id !== id);
                salvaDatabase();
                alert("Giocatore eliminato con successo!");
                mostraGiocatori();
            }
        }
        
        function eliminaPartita(id) {
            if(confirm("Eliminare questa partita? I risultati verranno tolti dalla classifica.")) {
                // Trovare la partita da eliminare
                const partita = database.partite.find(p => p.id === id);
                if(!partita) return;
                
                // Rimuovere i punti assegnati alle squadre
                let puntiCasa, puntiOspite;
                if(partita.golCasa > partita.golOspite) {
                    puntiCasa = 3;
                    puntiOspite = 0;
                } else if(partita.golCasa < partita.golOspite) {
                    puntiCasa = 0;
                    puntiOspite = 3;
                } else {
                    puntiCasa = 1;
                    puntiOspite = 1;
                }
                
                // Sottrarre punti e statistiche alle squadre
                database.squadre.forEach(squadra => {
                    if(squadra.nome === partita.squadraCasa) {
                        squadra.punti -= puntiCasa;
                        squadra.partiteGiocate--;
                        squadra.golFatti -= partita.golCasa;
                        squadra.golSubiti -= partita.golOspite;
                        if(puntiCasa === 3) squadra.vittorie--;
                        else if(puntiCasa === 1) squadra.pareggi--;
                        else squadra.sconfitte--;
                    }
                    if(squadra.nome === partita.squadraOspite) {
                        squadra.punti -= puntiOspite;
                        squadra.partiteGiocate--;
                        squadra.golFatti -= partita.golOspite;
                        squadra.golSubiti -= partita.golCasa;
                        if(puntiOspite === 3) squadra.vittorie--;
                        else if(puntiOspite === 1) squadra.pareggi--;
                        else squadra.sconfitte--;
                    }
                });
                
                // Eliminare la partita
                database.partite = database.partite.filter(p => p.id !== id);
                salvaDatabase();
                alert("Partita eliminata con successo!");
                mostraPartite();
            }
        }
        
        // Gestione eliminazione dati
        document.getElementById('tipoElimina').addEventListener('change', function() {
            const tipo = this.value;
            const container = document.getElementById('selezioneElimina');
            
            if(!tipo) {
                container.classList.add('hidden');
                return;
            }
            
            let html = '';
            
            switch(tipo) {
                case 'giocatore':
                    html = `
                        <label>Seleziona giocatore:</label>
                        <select id="giocatoreDaEliminare">
                            <option value="">Seleziona giocatore</option>
                            ${database.giocatori.map(g => 
                                `<option value="${g.id}">${g.nome} (${g.squadra})</option>`
                            ).join('')}
                        </select>
                    `;
                    break;
                    
                case 'squadra':
                    html = `
                        <label>Seleziona squadra:</label>
                        <select id="squadraDaEliminare">
                            <option value="">Seleziona squadra</option>
                            ${database.squadre.map(s => 
                                `<option value="${s.id}">${s.nome}</option>`
                            ).join('')}
                        </select>
                        <p><small>Attenzione: Verranno eliminati anche tutti i giocatori della squadra!</small></p>
                    `;
                    break;
                    
                case 'partita':
                    html = `
                        <label>Seleziona partita:</label>
                        <select id="partitaDaEliminare">
                            <option value="">Seleziona partita</option>
                            ${database.partite.map(p => 
                                `<option value="${p.id}">${p.squadraCasa} ${p.golCasa}-${p.golOspite} ${p.squadraOspite} (${p.data})</option>`
                            ).join('')}
                        </select>
                        <p><small>Attenzione: I punti verranno sottratti dalla classifica!</small></p>
                    `;
                    break;
                    
                case 'tutto':
                    html = `
                        <div style="background: #ffcccc; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            <h3>‚ö†Ô∏è PERICOLO ‚ö†Ô∏è</h3>
                            <p>Stai per eliminare TUTTI i dati:</p>
                            <ul>
                                <li>${database.squadre.length} squadre</li>
                                <li>${database.giocatori.length} giocatori</li>
                                <li>${database.partite.length} partite</li>
                            </ul>
                            <p>Questa operazione √® IRREVERSIBILE!</p>
                            <label>
                                <input type="checkbox" id="confermaEliminaTutto"> 
                                Confermo di voler eliminare TUTTI i dati
                            </label>
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = html;
            container.classList.remove('hidden');
        });
        
        function eseguiEliminazione() {
            const tipo = document.getElementById('tipoElimina').value;
            
            switch(tipo) {
                case 'giocatore':
                    const giocatoreId = parseInt(document.getElementById('giocatoreDaEliminare').value);
                    if(giocatoreId) eliminaGiocatore(giocatoreId);
                    break;
                    
                case 'squadra':
                    const squadraId = parseInt(document.getElementById('squadraDaEliminare').value);
                    if(squadraId) eliminaSquadra(squadraId);
                    break;
                    
                case 'partita':
                    const partitaId = parseInt(document.getElementById('partitaDaEliminare').value);
                    if(partitaId) eliminaPartita(partitaId);
                    break;
                    
                case 'tutto':
                    const conferma = document.getElementById('confermaEliminaTutto');
                    if(!conferma || !conferma.checked) {
                        alert("Devi selezionare la casella di conferma!");
                        return;
                    }
                    
                    if(confirm("‚ö†Ô∏è SEI SICURO DI VOLER ELIMINARE TUTTI I DATI? ‚ö†Ô∏è\nQuesta operazione non pu√≤ essere annullata!")) {
                        database = { squadre: [], giocatori: [], partite: [] };
                        salvaDatabase();
                        caricaSquadreNeiSelect();
                        caricaStatisticheElimina();
                        alert("Tutti i dati sono stati eliminati!");
                        document.getElementById('selezioneElimina').innerHTML = '';
                        document.getElementById('selezioneElimina').classList.add('hidden');
                    }
                    break;
                    
                default:
                    alert("Seleziona un'opzione di eliminazione!");
            }
        }
        
        // Carica statistiche per tab elimina
        function caricaStatisticheElimina() {
            document.getElementById('statSquadre').textContent = database.squadre.length;
            document.getElementById('statGiocatori').textContent = database.giocatori.length;
            document.getElementById('statPartite').textContent = database.partite.length;
            
            const totGol = database.partite.reduce((total, partita) => {
                return total + (partita.golCasa || 0) + (partita.golOspite || 0);
            }, 0);
            
            document.getElementById('statGol').textContent = totGol;
        }
        
        // Salva nel localStorage
        function salvaDatabase() {
            localStorage.setItem('rovigoal_squadre', JSON.stringify(database.squadre));
            localStorage.setItem('rovigoal_giocatori', JSON.stringify(database.giocatori));
            localStorage.setItem('rovigoal_partite', JSON.stringify(database.partite));
        }
        
        function tornaIndietro() {
            window.location.href = 'main.html';
        }
        
        // Controllo password all'entrata
        if(!localStorage.getItem('admin_accesso') || localStorage.getItem('admin_accesso') !== 'true') {
            const password = prompt("Inserisci la password ADMIN:");
            if(password !== "1246912.!!") {
                alert("Accesso negato!");
                window.location.href = 'main.html';
            } else {
                localStorage.setItem('admin_accesso', 'true');
            }
        }
    </script>
</body>
</html>

üìÅ FILE 1: admin.html

Crea un nuovo file admin.html nella stessa cartella degli altri file e incolla questo codice:

```html
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rovigoal - Area Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .header {
            background: linear-gradient(135deg, #FF4500 0%, #DC143C 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* TABS */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
        }
        
        .admin-tab {
            padding: 12px 25px;
            background: #2a5298;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
            text-align: center;
        }
        
        .admin-tab:hover {
            background: #1e3c72;
            transform: translateY(-2px);
        }
        
        .admin-tab.active {
            background: #FF4500;
            box-shadow: 0 0 15px rgba(255,69,0,0.5);
        }
        
        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            color: #333;
            margin-bottom: 30px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* FORM STYLES */
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #2a5298;
        }
        
        .form-section h3 {
            color: #1e3c72;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #495057;
            font-size: 0.9em;
        }
        
        input, select, textarea {
            padding: 12px 15px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.2);
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #218838 0%, #28a745 100%);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #DC143C 0%, #FF4500 100%);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #FF4500 0%, #DC143C 100%);
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #FFA500 0%, #FFD700 100%);
            transform: translateY(-2px);
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }
        
        /* EVENTI */
        .eventi-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #e9ecef;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .evento-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }
        
        .evento-item:hover {
            background-color: #f8f9fa;
        }
        
        .evento-item:last-child {
            border-bottom: none;
        }
        
        .evento-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .evento-icon {
            font-size: 1.2em;
            width: 30px;
            text-align: center;
        }
        
        .evento-gol { color: #28a745; }
        .evento-amm { color: #ffc107; }
        .evento-esp { color: #dc3545; }
        
        /* DANGER ZONE */
        .danger-zone {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border: 3px solid #dc3545;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
        }
        
        .danger-zone h3 {
            color: #dc3545;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .danger-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        /* STATS PANEL */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        /* LOADING & MESSAGES */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            display: none;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .message.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            display: block;
        }
        
        /* CONNECTION STATUS */
        .connessione-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .connessione-ok {
            background: #28a745;
            color: white;
            border: 2px solid #218838;
        }
        
        .connessione-caricamento {
            background: #ffc107;
            color: white;
            border: 2px solid #e0a800;
        }
        
        .connessione-ko {
            background: #dc3545;
            color: white;
            border: 2px solid #c82333;
        }
        
        /* PARTITE LIST */
        .partite-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 10px;
            background: white;
        }
        
        .partita-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .partita-item:hover {
            background-color: #f8f9fa;
        }
        
        .partita-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #2196F3;
        }
        
        /* MOBILE RESPONSIVE */
        @media (max-width: 768px) {
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab {
                min-width: 100%;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .danger-buttons {
                grid-template-columns: 1fr;
            }
            
            .connessione-status {
                top: 5px;
                right: 5px;
                padding: 6px 12px;
                font-size: 0.8em;
                position: relative;
                margin-top: 10px;
                display: inline-flex;
            }
            
            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .stats-panel {
                grid-template-columns: 1fr;
            }
            
            .tab-content {
                padding: 15px;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- MESSAGGI -->
    <div id="messageContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999; width: 300px;"></div>
    
    <!-- HEADER -->
    <div class="header">
        <h1>‚öôÔ∏è AREA ADMIN ROVIGOAL</h1>
        <p>Gestione completa del torneo</p>
        
        <div id="connessioneStatus" class="connessione-status connessione-caricamento">
            <div class="loading"></div> Connessione...
        </div>
    </div>
    
    <div class="container">
        <!-- TABS -->
        <div class="admin-tabs">
            <button class="admin-tab active" onclick="apriTab('dashboard')">üìä DASHBOARD</button>
            <button class="admin-tab" onclick="apriTab('partite')">‚öΩ GESTIONE PARTITE</button>
            <button class="admin-tab" onclick="apriTab('finale')">üèÜ GESTIONE FINALE</button>
            <button class="admin-tab" onclick="apriTab('giocatori')">üë• GESTIONE GIOCATORI</button>
            <button class="admin-tab" onclick="apriTab('squadre')">üèÅ GESTIONE SQUADRE</button>
            <button class="admin-tab" onclick="apriTab('danger')">‚ö†Ô∏è DANGER ZONE</button>
        </div>
        
        <!-- TAB 1: DASHBOARD -->
        <div id="dashboard" class="tab-content active">
            <h2>üìä Dashboard di Controllo</h2>
            
            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-value" id="statSquadre">0</div>
                    <div class="stat-label">Squadre Registrate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statGiocatori">0</div>
                    <div class="stat-label">Giocatori Totali</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statPartite">0</div>
                    <div class="stat-label">Partite Giocate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statGol">0</div>
                    <div class="stat-label">Gol Totali</div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>üìà Statistiche Live</h3>
                <div id="liveStats">
                    <p>Caricamento statistiche in tempo reale...</p>
                </div>
            </div>
            
            <div class="form-section">
                <h3>üîÑ Azioni Rapide</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="caricaDati()">
                        üîÑ Ricarica Tutti i Dati
                    </button>
                    <button class="btn btn-success" onclick="apriTab('partite')">
                        ‚ûï Nuova Partita
                    </button>
                    <button class="btn btn-warning" onclick="apriTab('finale')">
                        üèÜ Imposta Finale
                    </button>
                </div>
            </div>
        </div>
        
        <!-- TAB 2: GESTIONE PARTITE -->
        <div id="partite" class="tab-content">
            <h2>‚öΩ Gestione Partite</h2>
            
            <!-- NUOVA PARTITA -->
            <div class="form-section">
                <h3>‚ûï Crea Nuova Partita</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Data Partita:</label>
                        <input type="date" id="partitaData" required>
                    </div>
                    <div class="form-group">
                        <label>Ora Partita:</label>
                        <input type="time" id="partitaOra" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Squadra Casa:</label>
                        <select id="squadraCasa" required onchange="aggiornaGiocatoriSquadra('casa')">
                            <option value="">Seleziona squadra...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Squadra Ospite:</label>
                        <select id="squadraOspite" required onchange="aggiornaGiocatoriSquadra('ospite')">
                            <option value="">Seleziona squadra...</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Gol Squadra Casa:</label>
                        <input type="number" id="golCasa" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Gol Squadra Ospite:</label>
                        <input type="number" id="golOspite" min="0" value="0" required>
                    </div>
                </div>
                
                <h4 style="margin: 20px 0 10px 0; color: #1e3c72;">üéñÔ∏è Premi Partita</h4>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>üèÜ Miglior Giocatore (UNO SOLO):</label>
                        <select id="migliorGiocatore">
                            <option value="">Seleziona giocatore...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Voto Miglior Giocatore (1-10):</label>
                        <input type="number" id="votoMigliorGiocatore" min="1" max="10" placeholder="Es: 8">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ü•Ö Portiere Casa:</label>
                        <select id="portiereCasa">
                            <option value="">Seleziona portiere...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Voto Portiere Casa (1-10):</label>
                        <input type="number" id="votoPortiereCasa" min="1" max="10" placeholder="Es: 7">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ü•Ö Portiere Ospite:</label>
                        <select id="portiereOspite">
                            <option value="">Seleziona portiere...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Voto Portiere Ospite (1-10):</label>
                        <input type="number" id="votoPortiereOspite" min="1" max="10" placeholder="Es: 7">
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="salvaPartita()" style="margin-top: 20px;">
                    üíæ SALVA PARTITA
                </button>
            </div>
            
            <!-- GESTIONE EVENTI -->
            <div class="form-section">
                <h3>üìù Gestione Eventi Partita</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Seleziona Partita:</label>
                        <select id="selezionaPartita" onchange="caricaEventiPartita()">
                            <option value="">Seleziona una partita...</option>
                        </select>
                    </div>
                </div>
                
                <div id="eventiPartitaContainer" style="display: none;">
                    <h4>Eventi Partita Selezionata</h4>
                    <div id="listaEventi" class="eventi-container">
                        <p>Nessun evento per questa partita.</p>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-danger btn-small" onclick="eliminaEventiPartita()">
                            üóëÔ∏è Elimina TUTTI gli eventi
                        </button>
                    </div>
                </div>
                
                <h4 style="margin: 30px 0 15px 0; color: #1e3c72;">‚ûï Aggiungi Nuovo Evento</h4>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo Evento:</label>
                        <select id="tipoEvento">
                            <option value="gol">‚öΩ Gol</option>
                            <option value="amm">üü® Ammonizione</option>
                            <option value="esp">üü• Espulsione</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Squadra:</label>
                        <select id="eventoSquadra">
                            <option value="casa">Casa</option>
                            <option value="ospite">Ospite</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Giocatore:</label>
                        <select id="eventoGiocatore">
                            <option value="">Seleziona giocatore...</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="aggiungiEvento()">
                    ‚ûï Aggiungi Evento
                </button>
            </div>
            
            <!-- ELIMINA PARTITA -->
            <div class="form-section">
                <h3>üóëÔ∏è Elimina Partita</h3>
                <p><strong>Attenzione:</strong> L'eliminazione di una partita rimuover√† anche tutti gli eventi e voti associati.</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Seleziona Partita da Eliminare:</label>
                        <select id="partitaDaEliminare">
                            <option value="">Seleziona partita...</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-danger" onclick="eliminaPartitaSelezionata()">
                    üóëÔ∏è ELIMINA PARTITA SELEZIONATA
                </button>
            </div>
        </div>
        
        <!-- TAB 3: GESTIONE FINALE -->
        <div id="finale" class="tab-content">
            <h2>üèÜ Gestione Partita Finale</h2>
            <div class="message warning" id="finaleWarning">
                <strong>‚ö†Ô∏è IMPORTANTE:</strong> La finale √® SEPARATA dalle statistiche normali. I dati qui inseriti non influenzeranno le statistiche generali.
            </div>
            
            <!-- FORM FINALE -->
            <div class="form-section">
                <h3>üéØ Imposta Partita Finale</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Data Finale:</label>
                        <input type="date" id="finaleData" required>
                    </div>
                    <div class="form-group">
                        <label>Ora Finale:</label>
                        <input type="time" id="finaleOra" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Squadra Casa (Finale):</label>
                        <select id="finaleSquadraCasa" required>
                            <option value="">Seleziona squadra...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Squadra Ospite (Finale):</label>
                        <select id="finaleSquadraOspite" required>
                            <option value="">Seleziona squadra...</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Gol Squadra Casa:</label>
                        <input type="number" id="finaleGolCasa" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Gol Squadra Ospite:</label>
                        <input type="number" id="finaleGolOspite" min="0" value="0" required>
                    </div>
                </div>
                
                <h4 style="margin: 20px 0 10px 0; color: #1e3c72;">üéñÔ∏è Premi Finale</h4>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>üèÜ Miglior Giocatore Finale:</label>
                        <select id="finaleMigliorGiocatore">
                            <option value="">Seleziona giocatore...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Voto Miglior Giocatore (1-10):</label>
                        <input type="number" id="finaleVotoMigliorGiocatore" min="1" max="10">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ü•Ö Portiere Casa Finale:</label>
                        <select id="finalePortiereCasa">
                            <option value="">Seleziona portiere...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Voto Portiere Casa (1-10):</label>
                        <input type="number" id="finaleVotoPortiereCasa" min="1" max="10">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ü•Ö Portiere Ospite Finale:</label>
                        <select id="finalePortiereOspite">
                            <option value="">Seleziona portiere...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Voto Portiere Ospite (1-10):</label>
                        <input type="number" id="finaleVotoPortiereOspite" min="1" max="10">
                    </div>
                </div>
                
                <div style="margin-top: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="salvaFinale()">
                        üíæ SALVA FINALE
                    </button>
                    <button class="btn btn-warning" onclick="caricaFinaleEsistente()">
                        üîÑ Carica Finale Esistente
                    </button>
                </div>
            </div>
            
            <!-- ELIMINA FINALE -->
            <div class="form-section danger-zone">
                <h3>‚ö†Ô∏è Elimina Partita Finale</h3>
                <p><strong>Attenzione Massima:</strong> Stai per eliminare TUTTI i dati della finale. Questa operazione non pu√≤ essere annullata.</p>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-danger" onclick="eliminaFinale()">
                        üóëÔ∏è ELIMINA TUTTA LA FINALE
                    </button>
                </div>
            </div>
            
            <!-- EVENTI FINALE -->
            <div class="form-section">
                <h3>üìù Gestione Eventi Finale</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo Evento Finale:</label>
                        <select id="finaleTipoEvento">
                            <option value="gol">‚öΩ Gol</option>
                            <option value="amm">üü® Ammonizione</option>
                            <option value="esp">üü• Espulsione</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Squadra Finale:</label>
                        <select id="finaleEventoSquadra">
                            <option value="casa">Casa</option>
                            <option value="ospite">Ospite</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Giocatore Finale:</label>
                        <select id="finaleEventoGiocatore">
                            <option value="">Seleziona giocatore...</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="aggiungiEventoFinale()">
                    ‚ûï Aggiungi Evento Finale
                </button>
                
                <div style="margin-top: 30px;">
                    <h4>Eventi Finale Correnti</h4>
                    <div id="listaEventiFinale" class="eventi-container">
                        <p>Nessun evento per la finale.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TAB 4: GESTIONE GIOCATORI -->
        <div id="giocatori" class="tab-content">
            <h2>üë• Gestione Giocatori</h2>
            
            <!-- AGGIUNGI GIOCATORE -->
            <div class="form-section">
                <h3>‚ûï Aggiungi Nuovo Giocatore</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Nome Giocatore:</label>
                        <input type="text" id="nomeGiocatore" placeholder="Es: Mario Rossi" required>
                    </div>
                    <div class="form-group">
                        <label>Numero Maglia:</label>
                        <input type="number" id="numeroGiocatore" min="1" max="99" placeholder="Es: 10">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Squadra:</label>
                        <select id="squadraGiocatore" required>
                            <option value="">Seleziona squadra...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ruolo:</label>
                        <select id="ruoloGiocatore" required>
                            <option value="Giocatore">Giocatore</option>
                            <option value="Portiere">Portiere</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="aggiungiGiocatore()">
                    ‚ûï AGGIUNGI GIOCATORE
                </button>
            </div>
            
            <!-- ELIMINA GIOCATORE -->
            <div class="form-section">
                <h3>üóëÔ∏è Elimina Giocatore</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Seleziona Giocatore da Eliminare:</label>
                        <select id="giocatoreDaEliminare">
                            <option value="">Seleziona giocatore...</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-danger" onclick="eliminaGiocatoreSelezionato()">
                    üóëÔ∏è ELIMINA GIOCATORE
                </button>
                
                <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                    <strong>Nota:</strong> L'eliminazione di un giocatore rimuover√† anche le sue statistiche da tutte le partite.
                </p>
            </div>
            
            <!-- LISTA GIOCATORI -->
            <div class="form-section">
                <h3>üìã Lista Giocatori</h3>
                <div id="listaGiocatori" class="eventi-container">
                    <p>Caricamento giocatori...</p>
                </div>
            </div>
        </div>
        
        <!-- TAB 5: GESTIONE SQUADRE -->
        <div id="squadre" class="tab-content">
            <h2>üèÅ Gestione Squadre</h2>
            
            <!-- AGGIUNGI SQUADRA -->
            <div class="form-section">
                <h3>‚ûï Aggiungi Nuova Squadra</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Nome Squadra:</label>
                        <input type="text" id="nomeSquadra" placeholder="Es: Juventus" required>
                    </div>
                    <div class="form-group">
                        <label>Allenatore:</label>
                        <input type="text" id="allenatoreSquadra" placeholder="Es: Massimiliano Allegri">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Colori:</label>
                        <input type="text" id="coloriSquadra" placeholder="Es: Bianconero">
                    </div>
                    <div class="form-group">
                        <label>Punti Iniziali:</label>
                        <input type="number" id="puntiSquadra" min="0" value="0">
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="aggiungiSquadra()">
                    ‚ûï AGGIUNGI SQUADRA
                </button>
            </div>
            
            <!-- ELIMINA SQUADRA -->
            <div class="form-section">
                <h3>üóëÔ∏è Elimina Squadra</h3>
                <p><strong>Attenzione:</strong> Eliminando una squadra eliminerai anche tutti i suoi giocatori e le partite associate.</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Seleziona Squadra da Eliminare:</label>
                        <select id="squadraDaEliminare">
                            <option value="">Seleziona squadra...</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-danger" onclick="eliminaSquadraSelezionata()">
                    üóëÔ∏è ELIMINA SQUADRA
                </button>
            </div>
            
            <!-- LISTA SQUADRE -->
            <div class="form-section">
                <h3>üìã Lista Squadre</h3>
                <div id="listaSquadre" class="eventi-container">
                    <p>Caricamento squadre...</p>
                </div>
            </div>
        </div>
        
        <!-- TAB 6: DANGER ZONE -->
        <div id="danger" class="tab-content">
            <h2 style="color: #dc3545;">‚ö†Ô∏è ZONA PERICOLO - OPERAZIONI IRREVERSIBILI</h2>
            
            <div class="danger-zone">
                <h3>üö® ELIMINAZIONE MASCHERA</h3>
                <p><strong>LEGGI ATTENTAMENTE:</strong> Queste operazioni eliminano dati PERMANENTEMENTE dal database. Non c'√® possibilit√† di recupero.</p>
                
                <div class="danger-buttons">
                    <button class="btn btn-danger" onclick="eliminaTuttePartite()">
                        üóëÔ∏è Elimina TUTTE le Partite
                    </button>
                    <button class="btn btn-danger" onclick="eliminaTuttiGiocatori()">
                        üóëÔ∏è Elimina TUTTI i Giocatori
                    </button>
                    <button class="btn btn-danger" onclick="eliminaTutteSquadre()">
                        üóëÔ∏è Elimina TUTTE le Squadre
                    </button>
                    <button class="btn btn-danger" onclick="resetStatisticheGiocatori()">
                        üîÑ Reset Statistiche Giocatori
                    </button>
                    <button class="btn btn-danger" onclick="resetClassificaSquadre()">
                        üîÑ Reset Classifica Squadre
                    </button>
                </div>
            </div>
            
            <div class="danger-zone" style="margin-top: 30px; background: #000; border-color: #ff0000;">
                <h3>üíÄ NUCLEAR OPTION</h3>
                <p><strong>ESTREMA PERICOLOSIT√Ä:</strong> Questo pulsante ELIMINA TUTTO il database. Tornerai a una tabula rasa.</p>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-danger" onclick="eliminaTuttoDatabase()" 
                            style="font-size: 1.2em; padding: 15px 30px; background: linear-gradient(135deg, #ff0000 0%, #8b0000 100%);">
                        üí£ ELIMINA TUTTO IL DATABASE
                    </button>
                </div>
                
                <p style="margin-top: 15px; text-align: center; font-size: 0.9em;">
                    Dovrai confermare questa operazione DUE VOLTE.
                </p>
            </div>
            
            <div class="form-section" style="margin-top: 30px;">
                <h3>üîÑ Backup & Ripristino</h3>
                <p>Prima di qualsiasi operazione pericolosa, esporta un backup.</p>
                
                <div style="display: flex; gap: 15px; margin-top: 15px;">
                    <button class="btn btn-primary" onclick="esportaBackup()">
                        üíæ Esporta Backup JSON
                    </button>
                    <button class="btn btn-warning" onclick="importaBackup()">
                        üìÇ Importa Backup
                    </button>
                </div>
            </div>
        </div>
        
        <!-- PULSANTI NAVIGAZIONE -->
        <div style="display: flex; justify-content: space-between; margin-top: 30px; flex-wrap: wrap; gap: 15px;">
            <button class="btn btn-primary" onclick="tornaHome()">
                ‚Üê TORNA ALLA HOME
            </button>
            <button class="btn btn-danger" onclick="logoutAdmin()">
                üîí LOGOUT ADMIN
            </button>
        </div>
    </div>
    
    <!-- MODAL CONFERMA ELIMINAZIONE -->
    <div id="confirmModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
            <h3 id="confirmTitle" style="color: #dc3545; margin-bottom: 15px;">Conferma Eliminazione</h3>
            <p id="confirmMessage">Sei sicuro di voler procedere?</p>
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button class="btn btn-danger" onclick="confermaEliminazione()" style="flex: 1;">
                    CONFERMA
                </button>
                <button class="btn btn-primary" onclick="annullaEliminazione()" style="flex: 1;">
                    ANNULLA
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // Importa il gestore database Supabase
        import database from './database-supabase.js';
        
        // VARIABILI GLOBALI
        let datiTorneo = {
            squadre: [],
            giocatori: [],
            partite: [],
            finale: null
        };
        
        let ultimoAggiornamento = null;
        let azioneConfermata = null;
        let partitaSelezionata = null;
        let finaleEventi = [];
        
        // INIZIALIZZAZIONE
        document.addEventListener('DOMContentLoaded', async function() {
            // Controllo accesso
            if (!verificaAccessoAdmin()) {
                return;
            }
            
            aggiornaStatoConnessione('caricamento');
            
            try {
                // Carica dati iniziali
                await caricaDatiIniziali();
                
                // Setup listener in tempo reale
                setupRealtimeListeners();
                
                aggiornaStatoConnessione('ok');
                
                // Aggiorna interfaccia
                aggiornaDashboard();
                popolaSelectSquadre();
                popolaSelectGiocatori();
                popolaSelectPartite();
                
            } catch (error) {
                console.error('Errore inizializzazione admin:', error);
                aggiornaStatoConnessione('ko');
                mostraMessaggio('Errore nel caricamento dei dati. Riprova.', 'error');
            }
        });
        
        // VERIFICA ACCESSO ADMIN
        function verificaAccessoAdmin() {
            const passwordInserita = sessionStorage.getItem('admin_accesso');
            
            if (passwordInserita !== 'true') {
                const password = prompt("Inserisci la password ADMIN:");
                
                if (password === "1246912.!!") {
                    sessionStorage.setItem('admin_accesso', 'true');
                    return true;
                } else {
                    alert("Password errata! Accesso negato.");
                    window.location.href = 'main.html';
                    return false;
                }
            }
            
            return true;
        }
        
        // CARICA DATI INIZIALI
        async function caricaDatiIniziali() {
            try {
                const [squadre, giocatori, partite, finale] = await Promise.all([
                    database.getSquadre(),
                    database.getGiocatori(),
                    database.getPartite(),
                    database.getFinale()
                ]);
                
                datiTorneo.squadre = squadre || [];
                datiTorneo.giocatori = giocatori || [];
                datiTorneo.partite = partite || [];
                datiTorneo.finale = finale || null;
                
                if (datiTorneo.finale && datiTorneo.finale.eventi) {
                    finaleEventi = datiTorneo.finale.eventi;
                }
                
                ultimoAggiornamento = new Date();
                
                console.log('Dati admin caricati:', {
                    squadre: datiTorneo.squadre.length,
                    giocatori: datiTorneo.giocatori.length,
                    partite: datiTorneo.partite.length,
                    finale: !!datiTorneo.finale
                });
                
            } catch (error) {
                console.error('Errore caricamento dati:', error);
                throw error;
            }
        }
        
        // SETUP LISTENER TEMPO REALE
        function setupRealtimeListeners() {
            window.onDatabaseUpdate = function(type, data) {
                console.log(`Aggiornamento admin: ${type}`);
                
                if (type === 'squadre') {
                    datiTorneo.squadre = data || [];
                    popolaSelectSquadre();
                    aggiornaListaSquadre();
                } else if (type === 'giocatori') {
                    datiTorneo.giocatori = data || [];
                    popolaSelectGiocatori();
                    aggiornaListaGiocatori();
                } else if (type === 'partite') {
                    datiTorneo.partite = data || [];
                    popolaSelectPartite();
                } else if (type === 'finale') {
                    datiTorneo.finale = data || null;
                    if (data && data.eventi) {
                        finaleEventi = data.eventi;
                        aggiornaListaEventiFinale();
                    }
                }
                
                aggiornaDashboard();
                aggiornaStatoConnessione('ok');
                mostraMessaggio(`${type} aggiornati in tempo reale`, 'success', 3000);
            };
        }
        
        // FUNZIONI TAB
        function apriTab(tabName) {
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Aggiorna dati specifici del tab
            if (tabName === 'dashboard') {
                aggiornaDashboard();
            } else if (tabName === 'giocatori') {
                aggiornaListaGiocatori();
            } else if (tabName === 'squadre') {
                aggiornaListaSquadre();
            }
        }
        
        // AGGIORNA DASHBOARD
        function aggiornaDashboard() {
            // Statistiche
            document.getElementById('statSquadre').textContent = datiTorneo.squadre.length;
            document.getElementById('statGiocatori').textContent = datiTorneo.giocatori.length;
            document.getElementById('statPartite').textContent = datiTorneo.partite.length;
            
            let totGol = 0;
            datiTorneo.partite.forEach(p => {
                totGol += (p.gol_casa || 0) + (p.gol_ospite || 0);
            });
            document.getElementById('statGol').textContent = totGol;
            
            // Statistiche live
            const liveStats = document.getElementById('liveStats');
            let html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #1976D2;">${datiTorneo.squadre.length}</div>
                        <div style="color: #666; font-size: 0.9em;">Squadre attive</div>
                    </div>
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #4CAF50;">${datiTorneo.giocatori.filter(g => g.ruolo === 'Portiere').length}</div>
                        <div style="color: #666; font-size: 0.9em;">Portieri registrati</div>
                    </div>
                    <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #FF9800;">${totGol}</div>
                        <div style="color: #666; font-size: 0.9em;">Gol totali torneo</div>
                    </div>
                    <div style="background: #fce4ec; padding: 15px; border-radius: 8px;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #E91E63;">${datiTorneo.finale ? 'S√¨' : 'No'}</div>
                        <div style="color: #666; font-size: 0.9em;">Finale impostata</div>
                    </div>
                </div>
            `;
            
            if (ultimoAggiornamento) {
                html += `<p style="margin-top: 15px; color: #666; font-size: 0.9em;">Ultimo aggiornamento: ${ultimoAggiornamento.toLocaleTimeString('it-IT')}</p>`;
            }
            
            liveStats.innerHTML = html;
        }
        
        // POPOLA SELECT
        function popolaSelectSquadre() {
            const selects = [
                'squadraCasa', 'squadraOspite', 'squadraGiocatore', 'squadraDaEliminare',
                'finaleSquadraCasa', 'finaleSquadraOspite'
            ];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;
                
                const currentValue = select.value;
                select.innerHTML = '<option value="">Seleziona squadra...</option>';
                
                datiTorneo.squadre.sort((a, b) => a.nome.localeCompare(b.nome)).forEach(squadra => {
                    const option = document.createElement('option');
                    option.value = squadra.nome;
                    option.textContent = squadra.nome;
                    select.appendChild(option);
                });
                
                select.value = currentValue;
            });
        }
        
        function popolaSelectGiocatori() {
            const selects = [
                'migliorGiocatore', 'portiereCasa', 'portiereOspite',
                'eventoGiocatore', 'giocatoreDaEliminare',
                'finaleMigliorGiocatore', 'finalePortiereCasa', 'finalePortiereOspite',
                'finaleEventoGiocatore'
            ];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;
                
                const currentValue = select.value;
                select.innerHTML = '<option value="">Seleziona giocatore...</option>';
                
                // Filtra per ruolo se necessario
                let giocatoriFiltrati = [...datiTorneo.giocatori];
                
                if (selectId === 'portiereCasa' || selectId === 'portiereOspite' || 
                    selectId === 'finalePortiereCasa' || selectId === 'finalePortiereOspite') {
                    giocatoriFiltrati = giocatoriFiltrati.filter(g => g.ruolo === 'Portiere');
                }
                
                giocatoriFiltrati.sort((a, b) => a.nome.localeCompare(b.nome)).forEach(giocatore => {
                    const option = document.createElement('option');
                    option.value = giocatore.id;
                    option.textContent = `${giocatore.nome} (${giocatore.squadra})`;
                    select.appendChild(option);
                });
                
                select.value = currentValue;
            });
        }
        
        function popolaSelectPartite() {
            const selects = ['selezionaPartita', 'partitaDaEliminare'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;
                
                const currentValue = select.value;
                select.innerHTML = '<option value="">Seleziona partita...</option>';
                
                datiTorneo.partite.sort((a, b) => new Date(b.data) - new Date(a.data)).forEach(partita => {
                    const option = document.createElement('option');
                    option.value = partita.id;
                    option.textContent = `${partita.data} - ${partita.squadra_casa} vs ${partita.squadra_ospite} (${partita.gol_casa}-${partita.gol_ospite})`;
                    select.appendChild(option);
                });
                
                select.value = currentValue;
            });
        }
        
        // AGGIORNA GIOCATORI PER SQUADRA
        function aggiornaGiocatoriSquadra(tipo) {
            const selectSquadra = document.getElementById(`squadra${tipo === 'casa' ? 'Casa' : 'Ospite'}`);
            const selectGiocatore = document.getElementById(`eventoGiocatore`);
            const squadraSelezionata = selectSquadra.value;
            
            if (!squadraSelezionata) return;
            
            // Salva valore corrente
            const currentValue = selectGiocatore.value;
            
            // Filtra giocatori della squadra selezionata
            const giocatoriSquadra = datiTorneo.giocatori.filter(g => g.squadra === squadraSelezionata);
            
            // Aggiorna select giocatore
            selectGiocatore.innerHTML = '<option value="">Seleziona giocatore...</option>';
            giocatoriSquadra.forEach(giocatore => {
                const option = document.createElement('option');
                option.value = giocatore.id;
                option.textContent = `${giocatore.nome} #${giocatore.numero || '?'}`;
                selectGiocatore.appendChild(option);
            });
            
            // Ripristina valore se ancora valido
            if (giocatoriSquadra.some(g => g.id === currentValue)) {
                selectGiocatore.value = currentValue;
            }
        }
        
        // SALVA PARTITA
        async function salvaPartita() {
            try {
                // Validazione
                const squadraCasa = document.getElementById('squadraCasa').value;
                const squadraOspite = document.getElementById('squadraOspite').value;
                const golCasa = parseInt(document.getElementById('golCasa').value) || 0;
                const golOspite = parseInt(document.getElementById('golOspite').value) || 0;
                
                if (!squadraCasa || !squadraOspite) {
                    mostraMessaggio('Seleziona entrambe le squadre', 'error');
                    return;
                }
                
                if (squadraCasa === squadraOspite) {
                    mostraMessaggio('Le squadre non possono essere le stesse', 'error');
                    return;
                }
                
                // Calcola risultato per aggiornare classifica
                let puntiCasa = 0, puntiOspite = 0;
                let vittorieCasa = 0, vittorieOspite = 0;
                let pareggiCasa = 0, pareggiOspite = 0;
                let sconfitteCasa = 0, sconfitteOspite = 0;
                
                if (golCasa > golOspite) {
                    puntiCasa = 3;
                    vittorieCasa = 1;
                    sconfitteOspite = 1;
                } else if (golOspite > golCasa) {
                    puntiOspite = 3;
                    vittorieOspite = 1;
                    sconfitteCasa = 1;
                } else {
                    puntiCasa = 1;
                    puntiOspite = 1;
                    pareggiCasa = 1;
                    pareggiOspite = 1;
                }
                
                // Crea oggetto partita
                const partita = {
                    data: document.getElementById('partitaData').value,
                    ora: document.getElementById('partitaOra').value,
                    squadra_casa: squadraCasa,
                    squadra_ospite: squadraOspite,
                    gol_casa: golCasa,
                    gol_ospite: golOspite,
                    miglior_giocatore: document.getElementById('migliorGiocatore').value || null,
                    voto_miglior_giocatore: parseInt(document.getElementById('votoMigliorGiocatore').value) || null,
                    portiere_casa: document.getElementById('portiereCasa').value || null,
                    voto_portiere_casa: parseInt(document.getElementById('votoPortiereCasa').value) || null,
                    portiere_ospite: document.getElementById('portiereOspite').value || null,
                    voto_portiere_ospite: parseInt(document.getElementById('votoPortiereOspite').value) || null,
                    eventi: [] // Eventi aggiunti separatamente
                };
                
                // Salva partita
                const partitaSalvata = await database.aggiungiPartita(partita);
                mostraMessaggio('Partita salvata con successo!', 'success');
                
                // Aggiorna statistiche squadre
                await aggiornaStatisticheSquadre(squadraCasa, squadraOspite, golCasa, golOspite, 
                                                puntiCasa, puntiOspite, vittorieCasa, vittorieOspite,
                                                pareggiCasa, pareggiOspite, sconfitteCasa, sconfitteOspite);
                
                // Reset form
                document.getElementById('partitaData').value = '';
                document.getElementById('partitaOra').value = '';
                document.getElementById('golCasa').value = '0';
                document.getElementById('golOspite').value = '0';
                document.getElementById('migliorGiocatore').value = '';
                document.getElementById('votoMigliorGiocatore').value = '';
                document.getElementById('portiereCasa').value = '';
                document.getElementById('votoPortiereCasa').value = '';
                document.getElementById('portiereOspite').value = '';
                document.getElementById('votoPortiereOspite').value = '';
                
                // Aggiorna lista partite
                popolaSelectPartite();
                
            } catch (error) {
                console.error('Errore salvataggio partita:', error);
                mostraMessaggio('Errore nel salvataggio della partita', 'error');
            }
        }
        
        // AGGIUNGI EVENTO A PARTITA
        async function aggiungiEvento() {
            try {
                const partitaId = document.getElementById('selezionaPartita').value;
                if (!partitaId) {
                    mostraMessaggio('Seleziona prima una partita', 'error');
                    return;
                }
                
                const tipo = document.getElementById('tipoEvento').value;
                const squadra = document.getElementById('eventoSquadra').value;
                const giocatoreId = document.getElementById('eventoGiocatore').value;
                
                if (!giocatoreId) {
                    mostraMessaggio('Seleziona un giocatore', 'error');
                    return;
                }
                
                // Trova giocatore
                const giocatore = datiTorneo.giocatori.find(g => g.id === giocatoreId);
                if (!giocatore) {
                    mostraMessaggio('Giocatore non trovato', 'error');
                    return;
                }
                
                // Crea evento
                const evento = {
                    tipo: tipo,
                    squadra: squadra,
                    giocatoreId: giocatoreId,
                    giocatoreNome: giocatore.nome,
                    timestamp: new Date().toISOString()
                };
                
                // Trova partita
                const partita = datiTorneo.partite.find(p => p.id === partitaId);
                if (!partita) {
                    mostraMessaggio('Partita non trovata', 'error');
                    return;
                }
                
                // Aggiorna partita con nuovo evento
                const eventiAggiornati = [...(partita.eventi || []), evento];
                
                // Aggiorna statistiche giocatore
                await aggiornaStatisticheGiocatore(giocatoreId, tipo);
                
                // Aggiorna partita nel database
                await database.aggiornaPartita(partitaId, { eventi: eventiAggiornati });
                
                mostraMessaggio(`Evento ${tipo} aggiunto per ${giocatore.nome}`, 'success');
                
                // Aggiorna lista eventi
                caricaEventiPartita();
                
            } catch (error) {
                console.error('Errore aggiunta evento:', error);
                mostraMessaggio('Errore nell\'aggiunta dell\'evento', 'error');
            }
        }
        
        // CARICA EVENTI PARTITA
        async function caricaEventiPartita() {
            const partitaId = document.getElementById('selezionaPartita').value;
            
            if (!partitaId) {
                document.getElementById('eventiPartitaContainer').style.display = 'none';
                return;
            }
            
            const partita = datiTorneo.partite.find(p => p.id === partitaId);
            if (!partita) return;
            
            const container = document.getElementById('listaEventi');
            const eventi = partita.eventi || [];
            
            if (eventi.length === 0) {
                container.innerHTML = '<p>Nessun evento per questa partita.</p>';
            } else {
                let html = '';
                eventi.forEach((evento, index) => {
                    let icona = 'üìù';
                    let classe = '';
                    
                    if (evento.tipo === 'gol') {
                        icona = '‚öΩ';
                        classe = 'evento-gol';
                    } else if (evento.tipo === 'amm') {
                        icona = 'üü®';
                        classe = 'evento-amm';
                    } else if (evento.tipo === 'esp') {
                        icona = 'üü•';
                        classe = 'evento-esp';
                    }
                    
                    html += `
                        <div class="evento-item">
                            <div class="evento-info">
                                <span class="evento-icon ${classe}">${icona}</span>
                                <span>${evento.giocatoreNome} (${evento.squadra === 'casa' ? partita.squadra_casa : partita.squadra_ospite})</span>
                            </div>
                            <button class="btn btn-danger btn-small" onclick="eliminaSingoloEvento('${partitaId}', ${index})">
                                ‚ùå
                            </button>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }
            
            document.getElementById('eventiPartitaContainer').style.display = 'block';
        }
        
        // ELIMINA SINGOLO EVENTO
        async function eliminaSingoloEvento(partitaId, eventoIndex) {
            if (!confirm('Eliminare questo evento?')) return;
            
            try {
                const partita = datiTorneo.partite.find(p => p.id === partitaId);
                if (!partita) return;
                
                const eventi = [...(partita.eventi || [])];
                const eventoEliminato = eventi[eventoIndex];
                
                // Rimuovi evento
                eventi.splice(eventoIndex, 1);
                
                // Aggiorna statistiche giocatore (sottrai)
                await aggiornaStatisticheGiocatore(eventoEliminato.giocatoreId, eventoEliminato.tipo, true);
                
                // Aggiorna partita
                await database.aggiornaPartita(partitaId, { eventi: eventi });
                
                mostraMessaggio('Evento eliminato', 'success');
                caricaEventiPartita();
                
            } catch (error) {
                console.error('Errore eliminazione evento:', error);
                mostraMessaggio('Errore nell\'eliminazione dell\'evento', 'error');
            }
        }
        
        // ELIMINA TUTTI GLI EVENTI PARTITA
        async function eliminaEventiPartita() {
            const partitaId = document.getElementById('selezionaPartita').value;
            if (!partitaId) {
                mostraMessaggio('Seleziona una partita', 'error');
                return;
            }
            
            if (!confirm('Eliminare TUTTI gli eventi di questa partita?')) return;
            
            try {
                // Trova partita per aggiornare statistiche giocatori
                const partita = datiTorneo.partite.find(p => p.id === partitaId);
                if (partita && partita.eventi) {
                    // Sottrai statistiche per ogni evento
                    for (const evento of partita.eventi) {
                        await aggiornaStatisticheGiocatore(evento.giocatoreId, evento.tipo, true);
                    }
                }
                
                // Aggiorna partita con array vuoto
                await database.aggiornaPartita(partitaId, { eventi: [] });
                
                mostraMessaggio('Tutti gli eventi eliminati', 'success');
                caricaEventiPartita();
                
            } catch (error) {
                console.error('Errore eliminazione eventi:', error);
                mostraMessaggio('Errore nell\'eliminazione degli eventi', 'error');
            }
        }
        
        // ELIMINA PARTITA SELEZIONATA
        async function eliminaPartitaSelezionata() {
            const partitaId = document.getElementById('partitaDaEliminare').value;
            if (!partitaId) {
                mostraMessaggio('Seleziona una partita', 'error');
                return;
            }
            
            // Trova partita per info
            const partita = datiTorneo.partite.find(p => p.id === partitaId);
            if (!partita) return;
            
            mostraConferma(
                `Eliminare la partita ${partita.squadra_casa} vs ${partita.squadra_ospite}?`,
                'Questa operazione rimuover√† anche tutti gli eventi e voti associati.',
                async () => {
                    try {
                        // Prima aggiorna statistiche squadre (sottrai)
                        await revertStatisticheSquadre(partita);
                        
                        // Poi elimina partita
                        await database.eliminaPartita(partitaId);
                        
                        mostraMessaggio('Partita eliminata con successo', 'success');
                        document.getElementById('partitaDaEliminare').value = '';
                        
                    } catch (error) {
                        console.error('Errore eliminazione partita:', error);
                        mostraMessaggio('Errore nell\'eliminazione della partita', 'error');
                    }
                }
            );
        }
        
        // GESTIONE FINALE
        async function salvaFinale() {
            try {
                const finale = {
                    data: document.getElementById('finaleData').value,
                    ora: document.getElementById('finaleOra').value,
                    squadra_casa: document.getElementById('finaleSquadraCasa').value,
                    squadra_ospite: document.getElementById('finaleSquadraOspite').value,
                    gol_casa: parseInt(document.getElementById('finaleGolCasa').value) || 0,
                    gol_ospite: parseInt(document.getElementById('finaleGolOspite').value) || 0,
                    miglior_giocatore: document.getElementById('finaleMigliorGiocatore').value || null,
                    voto_miglior_giocatore: parseInt(document.getElementById('finaleVotoMigliorGiocatore').value) || null,
                    portiere_casa: document.getElementById('finalePortiereCasa').value || null,
                    voto_portiere_casa: parseInt(document.getElementById('finaleVotoPortiereCasa').value) || null,
                    portiere_ospite: document.getElementById('finalePortiereOspite').value || null,
                    voto_portiere_ospite: parseInt(document.getElementById('finaleVotoPortiereOspite').value) || null,
                    eventi: finaleEventi
                };
                
                // Validazione
                if (!finale.squadra_casa || !finale.squadra_ospite) {
                    mostraMessaggio('Seleziona entrambe le squadre', 'error');
                    return;
                }
                
                // Salva finale
                await database.salvaFinale(finale);
                mostraMessaggio('Finale salvata con successo!', 'success');
                
            } catch (error) {
                console.error('Errore salvataggio finale:', error);
                mostraMessaggio('Errore nel salvataggio della finale', 'error');
            }
        }
        
        function caricaFinaleEsistente() {
            if (!datiTorneo.finale) {
                mostraMessaggio('Nessuna finale salvata', 'warning');
                return;
            }
            
            const f = datiTorneo.finale;
            
            document.getElementById('finaleData').value = f.data || '';
            document.getElementById('finaleOra').value = f.ora || '';
            document.getElementById('finaleSquadraCasa').value = f.squadra_casa || '';
            document.getElementById('finaleSquadraOspite').value = f.squadra_ospite || '';
            document.getElementById('finaleGolCasa').value = f.gol_casa || 0;
            document.getElementById('finaleGolOspite').value = f.gol_ospite || 0;
            document.getElementById('finaleMigliorGiocatore').value = f.miglior_giocatore || '';
            document.getElementById('finaleVotoMigliorGiocatore').value = f.voto_miglior_giocatore || '';
            document.getElementById('finalePortiereCasa').value = f.portiere_casa || '';
            document.getElementById('finaleVotoPortiereCasa').value = f.voto_portiere_casa || '';
            document.getElementById('finalePortiereOspite').value = f.portiere_ospite || '';
            document.getElementById('finaleVotoPortiereOspite').value = f.voto_portiere_ospite || '';
            
            finaleEventi = f.eventi || [];
            aggiornaListaEventiFinale();
            
            mostraMessaggio('Finale caricata nel form', 'success');
        }
        
        async function eliminaFinale() {
            mostraConferma(
                'ELIMINARE TUTTA LA FINALE?',
                'Tutti i dati della partita finale verranno eliminati permanentemente.',
                async () => {
                    try {
                        // Elimina finale dal database
                        await database.eliminaFinale();
                        finaleEventi = [];
                        aggiornaListaEventiFinale();
                        
                        // Reset form
                        document.getElementById('finaleData').value = '';
                        document.getElementById('finaleOra').value = '';
                        document.getElementById('finaleGolCasa').value = '0';
                        document.getElementById('finaleGolOspite').value = '0';
                        document.getElementById('finaleMigliorGiocatore').value = '';
                        document.getElementById('finaleVotoMigliorGiocatore').value = '';
                        document.getElementById('finalePortiereCasa').value = '';
                        document.getElementById('finaleVotoPortiereCasa').value = '';
                        document.getElementById('finalePortiereOspite').value = '';
                        document.getElementById('finaleVotoPortiereOspite').value = '';
                        
                        mostraMessaggio('Finale eliminata con successo', 'success');
                        
                    } catch (error) {
                        console.error('Errore eliminazione finale:', error);
                        mostraMessaggio('Errore nell\'eliminazione della finale', 'error');
                    }
                }
            );
        }
        
        // AGGIUNGI EVENTO FINALE
        async function aggiungiEventoFinale() {
            try {
                const tipo = document.getElementById('finaleTipoEvento').value;
                const squadra = document.getElementById('finaleEventoSquadra').value;
                const giocatoreId = document.getElementById('finaleEventoGiocatore').value;
                
                if (!giocatoreId) {
                    mostraMessaggio('Seleziona un giocatore', 'error');
                    return;
                }
                
                const giocatore = datiTorneo.giocatori.find(g => g.id === giocatoreId);
                if (!giocatore) {
                    mostraMessaggio('Giocatore non trovato', 'error');
                    return;
                }
                
                const evento = {
                    tipo: tipo,
                    squadra: squadra,
                    giocatoreId: giocatoreId,
                    giocatoreNome: giocatore.nome,
                    timestamp: new Date().toISOString()
                };
                
                finaleEventi.push(evento);
                aggiornaListaEventiFinale();
                
                mostraMessaggio(`Evento ${tipo} aggiunto alla finale`, 'success');
                
            } catch (error) {
                console.error('Errore aggiunta evento finale:', error);
                mostraMessaggio('Errore nell\'aggiunta dell\'evento', 'error');
            }
        }
        
        function aggiornaListaEventiFinale() {
            const container = document.getElementById('listaEventiFinale');
            
            if (finaleEventi.length === 0) {
                container.innerHTML = '<p>Nessun evento per la finale.</p>';
                return;
            }
            
            let html = '';
            finaleEventi.forEach((evento, index) => {
                let icona = 'üìù';
                let classe = '';
                
                if (evento.tipo === 'gol') {
                    icona = '‚öΩ';
                    classe = 'evento-gol';
                } else if (evento.tipo === 'amm') {
                    icona = 'üü®';
                    classe = 'evento-amm';
                } else if (evento.tipo === 'esp') {
                    icona = 'üü•';
                    classe = 'evento-esp';
                }
                
                html += `
                    <div class="evento-item">
                        <div class="evento-info">
                            <span class="evento-icon ${classe}">${icona}</span>
                            <span>${evento.giocatoreNome} (${evento.squadra})</span>
                        </div>
                        <button class="btn btn-danger btn-small" onclick="eliminaEventoFinale(${index})">
                            ‚ùå
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function eliminaEventoFinale(index) {
            if (!confirm('Eliminare questo evento dalla finale?')) return;
            
            finaleEventi.splice(index, 1);
            aggiornaListaEventiFinale();
            mostraMessaggio('Evento eliminato dalla finale', 'success');
        }
        
        // GESTIONE GIOCATORI
        async function aggiungiGiocatore() {
            try {
                const giocatore = {
                    nome: document.getElementById('nomeGiocatore').value,
                    numero: parseInt(document.getElementById('numeroGiocatore').value) || null,
                    squadra: document.getElementById('squadraGiocatore').value,
                    ruolo: document.getElementById('ruoloGiocatore').value,
                    gol: 0,
                    ammonizioni: 0,
                    espulsioni: 0,
                    punteggio_totale: 0,
                    premi_miglior_giocatore: 0,
                    premi_miglior_portiere: 0
                };
                
                if (!giocatore.nome || !giocatore.squadra || !giocatore.ruolo) {
                    mostraMessaggio('Compila tutti i campi obbligatori', 'error');
                    return;
                }
                
                await database.aggiungiGiocatore(giocatore);
                mostraMessaggio(`Giocatore ${giocatore.nome} aggiunto`, 'success');
                
                // Reset form
                document.getElementById('nomeGiocatore').value = '';
                document.getElementById('numeroGiocatore').value = '';
                
                // Aggiorna lista
                aggiornaListaGiocatori();
                
            } catch (error) {
                console.error('Errore aggiunta giocatore:', error);
                mostraMessaggio('Errore nell\'aggiunta del giocatore', 'error');
            }
        }
        
        async function eliminaGiocatoreSelezionato() {
            const giocatoreId = document.getElementById('giocatoreDaEliminare').value;
            if (!giocatoreId) {
                mostraMessaggio('Seleziona un giocatore', 'error');
                return;
            }
            
            const giocatore = datiTorneo.giocatori.find(g => g.id === giocatoreId);
            if (!giocatore) return;
            
            mostraConferma(
                `Eliminare il giocatore ${giocatore.nome}?`,
                'Verranno rimosse anche le sue statistiche da tutte le partite.',
                async () => {
                    try {
                        await database.eliminaGiocatore(giocatoreId);
                        mostraMessaggio('Giocatore eliminato', 'success');
                        document.getElementById('giocatoreDaEliminare').value = '';
                        
                    } catch (error) {
                        console.error('Errore eliminazione giocatore:', error);
                        mostraMessaggio('Errore nell\'eliminazione del giocatore', 'error');
                    }
                }
            );
        }
        
        function aggiornaListaGiocatori() {
            const container = document.getElementById('listaGiocatori');
            
            if (datiTorneo.giocatori.length === 0) {
                container.innerHTML = '<p>Nessun giocatore registrato.</p>';
                return;
            }
            
            let html = '';
            datiTorneo.giocatori.sort((a, b) => a.nome.localeCompare(b.nome)).forEach(giocatore => {
                html += `
                    <div class="evento-item">
                        <div class="evento-info">
                            <span style="font-weight: bold;">${giocatore.nome}</span>
                            <span style="color: #666; font-size: 0.9em;">
                                ${giocatore.squadra} | ${giocatore.ruolo} 
                                ${giocatore.numero ? `| #${giocatore.numero}` : ''}
                            </span>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            ${giocatore.gol > 0 ? `<span style="background: #90EE90; padding: 2px 6px; border-radius: 3px; font-size: 0.8em;">‚öΩ ${giocatore.gol}</span>` : ''}
                            ${giocatore.ammonizioni > 0 ? `<span style="background: #FFFACD; padding: 2px 6px; border-radius: 3px; font-size: 0.8em;">üü® ${giocatore.ammonizioni}</span>` : ''}
                            ${giocatore.espulsioni > 0 ? `<span style="background: #FFB6C1; padding: 2px 6px; border-radius: 3px; font-size: 0.8em;">üü• ${giocatore.espulsioni}</span>` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // GESTIONE SQUADRE
        async function aggiungiSquadra() {
            try {
                const squadra = {
                    nome: document.getElementById('nomeSquadra').value,
                    allenatore: document.getElementById('allenatoreSquadra').value || null,
                    colori: document.getElementById('coloriSquadra').value || null,
                    punti: parseInt(document.getElementById('puntiSquadra').value) || 0,
                    partite_giocate: 0,
                    vittorie: 0,
                    pareggi: 0,
                    sconfitte: 0,
                    gol_fatti: 0,
                    gol_subiti: 0
                };
                
                if (!squadra.nome) {
                    mostraMessaggio('Inserisci il nome della squadra', 'error');
                    return;
                }
                
                await database.aggiungiSquadra(squadra);
                mostraMessaggio(`Squadra ${squadra.nome} aggiunta`, 'success');
                
                // Reset form
                document.getElementById('nomeSquadra').value = '';
                document.getElementById('allenatoreSquadra').value = '';
                document.getElementById('coloriSquadra').value = '';
                document.getElementById('puntiSquadra').value = '0';
                
                // Aggiorna lista
                aggiornaListaSquadre();
                
            } catch (error) {
                console.error('Errore aggiunta squadra:', error);
                mostraMessaggio('Errore nell\'aggiunta della squadra', 'error');
            }
        }
        
        async function eliminaSquadraSelezionata() {
            const squadraNome = document.getElementById('squadraDaEliminare').value;
            if (!squadraNome) {
                mostraMessaggio('Seleziona una squadra', 'error');
                return;
            }
            
            const squadra = datiTorneo.squadre.find(s => s.nome === squadraNome);
            if (!squadra) return;
            
            // Controlla se ci sono giocatori nella squadra
            const giocatoriSquadra = datiTorneo.giocatori.filter(g => g.squadra === squadraNome);
            
            mostraConferma(
                `Eliminare la squadra ${squadra.nome}?`,
                `Verranno eliminati ${giocatoriSquadra.length} giocatori e tutte le partite associate.`,
                async () => {
                    try {
                        // Prima elimina tutti i giocatori della squadra
                        for (const giocatore of giocatoriSquadra) {
                            await database.eliminaGiocatore(giocatore.id);
                        }
                        
                        // Poi elimina la squadra
                        await database.eliminaSquadra(squadra.id);
                        
                        mostraMessaggio('Squadra eliminata', 'success');
                        document.getElementById('squadraDaEliminare').value = '';
                        
                    } catch (error) {
                        console.error('Errore eliminazione squadra:', error);
                        mostraMessaggio('Errore nell\'eliminazione della squadra', 'error');
                    }
                }
            );
        }
        
        function aggiornaListaSquadre() {
            const container = document.getElementById('listaSquadre');
            
            if (datiTorneo.squadre.length === 0) {
                container.innerHTML = '<p>Nessuna squadra registrata.</p>';
                return;
            }
            
            let html = '';
            datiTorneo.squadre.sort((a, b) => b.punti - a.punti).forEach(squadra => {
                html += `
                    <div class="evento-item">
                        <div class="evento-info">
                            <span style="font-weight: bold;">${squadra.nome}</span>
                            <span style="color: #666; font-size: 0.9em;">
                                ${squadra.allenatore ? `Allenatore: ${squadra.allenatore}` : ''}
                                ${squadra.colori ? ` | Colori: ${squadra.colori}` : ''}
                            </span>
                        </div>
                        <div>
                            <span style="font-weight: bold; color: #1e3c72;">${squadra.punti} pt</span>
                            <span style="font-size: 0.9em; color: #666; margin-left: 10px;">
                                ${squadra.gol_fatti || 0}/${squadra.gol_subiti || 0}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // DANGER ZONE FUNCTIONS
        function eliminaTuttePartite() {
            mostraConferma(
                'ELIMINARE TUTTE LE PARTITE?',
                'Tutte le partite, eventi e voti verranno eliminati. La classifica verr√† resettata.',
                async () => {
                    try {
                        // Prima resetta statistiche squadre
                        for (const squadra of datiTorneo.squadre) {
                            await database.aggiornaSquadra(squadra.id, {
                                partite_giocate: 0,
                                vittorie: 0,
                                pareggi: 0,
                                sconfitte: 0,
                                gol_fatti: 0,
                                gol_subiti: 0,
                                punti: 0
                            });
                        }
                        
                        // Poi elimina tutte le partite
                        // Nota: questa funzione deve essere implementata in database-supabase.js
                        mostraMessaggio('Funzione da implementare in database-supabase.js', 'warning');
                        
                    } catch (error) {
                        console.error('Errore eliminazione partite:', error);
                        mostraMessaggio('Errore nell\'eliminazione delle partite', 'error');
                    }
                }
            );
        }
        
        function eliminaTuttiGiocatori() {
            mostraConferma(
                'ELIMINARE TUTTI I GIOCATORI?',
                'Tutti i giocatori e le loro statistiche verranno eliminati.',
                async () => {
                    try {
                        mostraMessaggio('Funzione da implementare in database-supabase.js', 'warning');
                    } catch (error) {
                        console.error('Errore eliminazione giocatori:', error);
                        mostraMessaggio('Errore nell\'eliminazione dei giocatori', 'error');
                    }
                }
            );
        }
        
        function eliminaTutteSquadre() {
            mostraConferma(
                'ELIMINARE TUTTE LE SQUADRE?',
                'Tutte le squadre, i loro giocatori e le partite verranno eliminati.',
                async () => {
                    try {
                        mostraMessaggio('Funzione da implementare in database-supabase.js', 'warning');
                    } catch (error) {
                        console.error('Errore eliminazione squadre:', error);
                        mostraMessaggio('Errore nell\'eliminazione delle squadre', 'error');
                    }
                }
            );
        }
        
        async function resetStatisticheGiocatori() {
            mostraConferma(
                'RESETTARE TUTTE LE STATISTICHE DEI GIOCATORI?',
                'Tutti i gol, ammonizioni, espulsioni e voti verranno azzerati.',
                async () => {
                    try {
                        for (const giocatore of datiTorneo.giocatori) {
                            await database.aggiornaGiocatore(giocatore.id, {
                                gol: 0,
                                ammonizioni: 0,
                                espulsioni: 0,
                                punteggio_totale: 0,
                                premi_miglior_giocatore: 0,
                                premi_miglior_portiere: 0
                            });
                        }
                        
                        mostraMessaggio('Statistiche giocatori resettate', 'success');
                        
                    } catch (error) {
                        console.error('Errore reset statistiche:', error);
                        mostraMessaggio('Errore nel reset delle statistiche', 'error');
                    }
                }
            );
        }
        
        async function resetClassificaSquadre() {
            mostraConferma(
                'RESETTARE LA CLASSIFICA?',
                'Tutti i punti e le statistiche delle squadre verranno azzerati.',
                async () => {
                    try {
                        for (const squadra of datiTorneo.squadre) {
                            await database.aggiornaSquadra(squadra.id, {
                                punti: 0,
                                partite_giocate: 0,
                                vittorie: 0,
                                pareggi: 0,
                                sconfitte: 0,
                                gol_fatti: 0,
                                gol_subiti: 0
                            });
                        }
                        
                        mostraMessaggio('Classifica resettata', 'success');
                        
                    } catch (error) {
                        console.error('Errore reset classifica:', error);
                        mostraMessaggio('Errore nel reset della classifica', 'error');
                    }
                }
            );
        }
        
        function eliminaTuttoDatabase() {
            mostraConferma(
                'üí£ ELIMINARE TUTTO IL DATABASE?',
                'Questa operazione ELIMINER√Ä TUTTO: squadre, giocatori, partite, finale. NON C\'√à POSSIBILIT√Ä DI RECUPERO!',
                () => {
                    // Seconda conferma
                    mostraConferma(
                        'CONFERMA DEFINITIVA',
                        'Sei ASSOLUTAMENTE SICURO di voler eliminare TUTTO il database? Scrivi "ELIMINA TUTTO" per confermare.',
                        async () => {
                            const confermaTesto = prompt('Scrivi "ELIMINA TUTTO" per confermare:');
                            if (confermaTesto !== 'ELIMINA TUTTO') {
                                mostraMessaggio('Operazione annullata', 'warning');
                                return;
                            }
                            
                            try {
                                await database.eliminaTutto();
                                mostraMessaggio('Database completamente eliminato', 'success');
                                setTimeout(() => location.reload(), 2000);
                                
                            } catch (error) {
                                console.error('Errore eliminazione database:', error);
                                mostraMessaggio('Errore nell\'eliminazione del database', 'error');
                            }
                        }
                    );
                }
            );
        }
        
        // UTILITY FUNCTIONS
        async function aggiornaStatisticheSquadre(squadraCasa, squadraOspite, golCasa, golOspite, 
                                                puntiCasa, puntiOspite, vittorieCasa, vittorieOspite,
                                                pareggiCasa, pareggiOspite, sconfitteCasa, sconfitteOspite) {
            try {
                // Trova squadre
                const squadraCasaObj = datiTorneo.squadre.find(s => s.nome === squadraCasa);
                const squadraOspiteObj = datiTorneo.squadre.find(s => s.nome === squadraOspite);
                
                if (!squadraCasaObj || !squadraOspiteObj) return;
                
                // Aggiorna squadra casa
                await database.aggiornaSquadra(squadraCasaObj.id, {
                    punti: (squadraCasaObj.punti || 0) + puntiCasa,
                    partite_giocate: (squadraCasaObj.partite_giocate || 0) + 1,
                    vittorie: (squadraCasaObj.vittorie || 0) + vittorieCasa,
                    pareggi: (squadraCasaObj.pareggi || 0) + pareggiCasa,
                    sconfitte: (squadraCasaObj.sconfitte || 0) + sconfitteCasa,
                    gol_fatti: (squadraCasaObj.gol_fatti || 0) + golCasa,
                    gol_subiti: (squadraCasaObj.gol_subiti || 0) + golOspite
                });
                
                // Aggiorna squadra ospite
                await database.aggiornaSquadra(squadraOspiteObj.id, {
                    punti: (squadraOspiteObj.punti || 0) + puntiOspite,
                    partite_giocate: (squadraOspiteObj.partite_giocate || 0) + 1,
                    vittorie: (squadraOspiteObj.vittorie || 0) + vittorieOspite,
                    pareggi: (squadraOspiteObj.pareggi || 0) + pareggiOspite,
                    sconfitte: (squadraOspiteObj.sconfitte || 0) + sconfitteOspite,
                    gol_fatti: (squadraOspiteObj.gol_fatti || 0) + golOspite,
                    gol_subiti: (squadraOspiteObj.gol_subiti || 0) + golCasa
                });
                
            } catch (error) {
                console.error('Errore aggiornamento statistiche squadre:', error);
            }
        }
        
        async function revertStatisticheSquadre(partita) {
            try {
                const squadraCasaObj = datiTorneo.squadre.find(s => s.nome === partita.squadra_casa);
                const squadraOspiteObj = datiTorneo.squadre.find(s => s.nome === partita.squadra_ospite);
                
                if (!squadraCasaObj || !squadraOspiteObj) return;
                
                // Calcola cosa sottrarre
                const golCasa = partita.gol_casa || 0;
                const golOspite = partita.gol_ospite || 0;
                
                let puntiCasa = 0, puntiOspite = 0;
                let vittorieCasa = 0, vittorieOspite = 0;
                let pareggiCasa = 0, pareggiOspite = 0;
                let sconfitteCasa = 0, sconfitteOspite = 0;
                
                if (golCasa > golOspite) {
                    puntiCasa = 3;
                    vittorieCasa = 1;
                    sconfitteOspite = 1;
                } else if (golOspite > golCasa) {
                    puntiOspite = 3;
                    vittorieOspite = 1;
                    sconfitteCasa = 1;
                } else {
                    puntiCasa = 1;
                    puntiOspite = 1;
                    pareggiCasa = 1;
                    pareggiOspite = 1;
                }
                
                // Sottrai statistiche squadra casa
                await database.aggiornaSquadra(squadraCasaObj.id, {
                    punti: Math.max(0, (squadraCasaObj.punti || 0) - puntiCasa),
                    partite_giocate: Math.max(0, (squadraCasaObj.partite_giocate || 0) - 1),
                    vittorie: Math.max(0, (squadraCasaObj.vittorie || 0) - vittorieCasa),
                    pareggi: Math.max(0, (squadraCasaObj.pareggi || 0) - pareggiCasa),
                    sconfitte: Math.max(0, (squadraCasaObj.sconfitte || 0) - sconfitteCasa),
                    gol_fatti: Math.max(0, (squadraCasaObj.gol_fatti || 0) - golCasa),
                    gol_subiti: Math.max(0, (squadraCasaObj.gol_subiti || 0) - golOspite)
                });
                
                // Sottrai statistiche squadra ospite
                await database.aggiornaSquadra(squadraOspiteObj.id, {
                    punti: Math.max(0, (squadraOspiteObj.punti || 0) - puntiOspite),
                    partite_giocate: Math.max(0, (squadraOspiteObj.partite_giocate || 0) - 1),
                    vittorie: Math.max(0, (squadraOspiteObj.vittorie || 0) - vittorieOspite),
                    pareggi: Math.max(0, (squadraOspiteObj.pareggi || 0) - pareggiOspite),
                    sconfitte: Math.max(0, (squadraOspiteObj.sconfitte || 0) - sconfitteOspite),
                    gol_fatti: Math.max(0, (squadraOspiteObj.gol_fatti || 0) - golOspite),
                    gol_subiti: Math.max(0, (squadraOspiteObj.gol_subiti || 0) - golCasa)
                });
                
            } catch (error) {
                console.error('Errore revert statistiche squadre:', error);
            }
        }
        
        async function aggiornaStatisticheGiocatore(giocatoreId, tipo, sottrai = false) {
            try {
                const giocatore = datiTorneo.giocatori.find(g => g.id === giocatoreId);
                if (!giocatore) return;
                
                const updates = { ...giocatore };
                const modifica = sottrai ? -1 : 1;
                
                switch(tipo) {
                    case 'gol':
                        updates.gol = Math.max(0, (updates.gol || 0) + modifica);
                        break;
                    case 'amm':
                        updates.ammonizioni = Math.max(0, (updates.ammonizioni || 0) + modifica);
                        break;
                    case 'esp':
                        updates.espulsioni = Math.max(0, (updates.espulsioni || 0) + modifica);
                        break;
                }
                
                await database.aggiornaGiocatore(giocatoreId, updates);
                
            } catch (error) {
                console.error('Errore aggiornamento statistiche giocatore:', error);
            }
        }
        
        function caricaDati() {
            location.reload();
        }
        
        function esportaBackup() {
            const backup = {
                timestamp: new Date().toISOString(),
                squadre: datiTorneo.squadre,
                giocatori: datiTorneo.giocatori,
                partite: datiTorneo.partite,
                finale: datiTorneo.finale
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rovigoal-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            mostraMessaggio('Backup esportato', 'success');
        }
        
        function importaBackup() {
            mostraMessaggio('Funzionalit√† di import da implementare', 'warning');
        }
        
        // NAVIGAZIONE
        function tornaHome() {
            window.location.href = 'main.html';
        }
        
        function logoutAdmin() {
            sessionStorage.removeItem('admin_accesso');
            window.location.href = 'main.html';
        }
        
        // MESSAGGI E CONFERME
        function mostraMessaggio(testo, tipo = 'info', durata = 5000) {
            const container = document.getElementById('messageContainer');
            
            const message = document.createElement('div');
            message.className = `message ${tipo}`;
            message.innerHTML = testo;
            
            container.appendChild(message);
            
            // Rimuovi dopo la durata
            setTimeout(() => {
                if (message.parentNode) {
                    message.style.opacity = '0';
                    message.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        if (message.parentNode) {
                            message.parentNode.removeChild(message);
                        }
                    }, 500);
                }
            }, durata);
        }
        
        function mostraConferma(titolo, messaggio, callback) {
            document.getElementById('confirmTitle').textContent = titolo;
            document.getElementById('confirmMessage').textContent = messaje;
            document.getElementById('confirmModal').style.display = 'flex';
            
            azioneConfermata = callback;
        }
        
        function confermaEliminazione() {
            if (azioneConfermata) {
                azioneConfermata();
            }
            annullaEliminazione();
        }
        
        function annullaEliminazione() {
            document.getElementById('confirmModal').style.display = 'none';
            azioneConfermata = null;
        }
        
        function aggiornaStatoConnessione(stato) {
            const statusElement = document.getElementById('connessioneStatus');
            
            switch(stato) {
                case 'caricamento':
                    statusElement.className = 'connessione-status connessione-caricamento';
                    statusElement.innerHTML = '<div class="loading"></div> Connessione...';
                    break;
                    
                case 'ok':
                    statusElement.className = 'connessione-status connessione-ok';
                    statusElement.innerHTML = '‚úì Connesso';
                    break;
                    
                case 'ko':
                    statusElement.className = 'connessione-status connessione-ko';
                    statusElement.innerHTML = '‚úó Disconnesso';
                    break;
            }
        }
        
        // ESPORTA FUNZIONI GLOBALI
        window.apriTab = apriTab;
        window.tornaHome = tornaHome;
        window.logoutAdmin = logoutAdmin;
        window.caricaDati = caricaDati;
        window.salvaPartita = salvaPartita;
        window.aggiungiEvento = aggiungiEvento;
        window.caricaEventiPartita = caricaEventiPartita;
        window.eliminaSingoloEvento = eliminaSingoloEvento;
        window.eliminaEventiPartita = eliminaEventiPartita;
        window.eliminaPartitaSelezionata = eliminaPartitaSelezionata;
        window.salvaFinale = salvaFinale;
        window.caricaFinaleEsistente = caricaFinaleEsistente;
        window.eliminaFinale = eliminaFinale;
        window.aggiungiEventoFinale = aggiungiEventoFinale;
        window.eliminaEventoFinale = eliminaEventoFinale;
        window.aggiungiGiocatore = aggiungiGiocatore;
        window.eliminaGiocatoreSelezionato = eliminaGiocatoreSelezionato;
        window.aggiungiSquadra = aggiungiSquadra;
        window.eliminaSquadraSelezionata = eliminaSquadraSelezionata;
        window.eliminaTuttePartite = eliminaTuttePartite;
        window.eliminaTuttiGiocatori = eliminaTuttiGiocatori;
        window.eliminaTutteSquadre = eliminaTutteSquadre;
        window.resetStatisticheGiocatori = resetStatisticheGiocatori;
        window.resetClassificaSquadre = resetClassificaSquadre;
        window.eliminaTuttoDatabase = eliminaTuttoDatabase;
        window.esportaBackup = esportaBackup;
        window.importaBackup = importaBackup;
        window.confermaEliminazione = confermaEliminazione;
        window.annullaEliminazione = annullaEliminazione;
        
    </script>
</body>
</html>
```

Ora ti creo il file aggiornato database-supabase.js nel prossimo messaggio...

<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rovigoal - Area Admin</title>
    <style>
        /* Stili mantenuti e ottimizzati per mobile */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background: #f0f2f5; padding: 20px; }
        
        .btn-home {
            position: fixed; top: 20px; right: 20px; background: #1e3c72; color: white; border: none;
            padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; z-index: 1000;
        }
        
        .header {
            background: linear-gradient(135deg, #FF4500 0%, #DC143C 100%); color: white; padding: 20px;
            border-radius: 10px; margin-bottom: 30px; text-align: center;
        }
        
        .menu-admin {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;
            max-width: 1000px; margin: 0 auto 40px;
        }
        
        .menu-btn {
            background: white; padding: 40px 20px; border-radius: 15px; text-align: center; 
            font-weight: bold; cursor: pointer; transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .menu-btn:hover { transform: translateY(-5px); }
        
        .sezione { background: white; padding: 25px; border-radius: 10px; display: none; max-width: 1000px; margin: 0 auto; }
        .sezione.attiva { display: block; }
        
        .form-group { margin-bottom: 15px; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 5px; }
        
        .btn { padding: 12px 25px; border-radius: 5px; cursor: pointer; font-weight: bold; border: none; margin-top: 10px; }
        .btn-green { background: #2ecc71; color: white; }
        .btn-blue { background: #3498db; color: white; }
        .btn-red { background: #e74c3c; color: white; }
        
        .stella { font-size: 24px; cursor: pointer; color: #ddd; }
        .stella.selezionata { color: #FFD700; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <button class="btn-home" onclick="location.href='main.html'">üè† HOME</button>
    
    <div class="header">
        <h1>üîß AREA ADMIN ROVIGOAL</h1>
        <p>Gestione Database Supabase</p>
    </div>

    <div class="menu-admin" id="menuPrincipale">
        <div class="menu-btn" onclick="mostraSezione('gestione')">üë• SQUADRE & GIOCATORI</div>
        <div class="menu-btn" onclick="mostraSezione('partite')">‚öΩ INSERISCI PARTITA</div>
        <div class="menu-btn" onclick="mostraSezione('elencoPartite')">üìã ELENCO PARTITE</div>
    </div>

    <div id="gestione" class="sezione">
        <h2>Aggiungi Squadra</h2>
        <div class="form-group">
            <input type="text" id="nomeSquadra" placeholder="Nome Squadra">
            <button class="btn btn-green" onclick="aggiungiSquadra()">Aggiungi</button>
        </div>

        <hr>

        <h2>Aggiungi Giocatore</h2>
        <div class="form-group">
            <select id="squadraSelezionata"></select>
            <input type="text" id="nomeGiocatore" placeholder="Nome Giocatore">
            <select id="ruoloGiocatore">
                <option value="Giocatore">Giocatore</option>
                <option value="Portiere">Portiere</option>
            </select>
            <button class="btn btn-blue" onclick="aggiungiGiocatore()">Aggiungi</button>
        </div>
        <button class="btn btn-red" onclick="tornaMenu()">Indietro</button>
    </div>

    <div id="partite" class="sezione">
        <h2>Inserimento Partita</h2>
        <div class="form-group">
            <label>Casa</label>
            <select id="casaSelect"></select>
            <label>Ospite</label>
            <select id="ospiteSelect"></select>
        </div>
        <div class="form-group">
            <input type="number" id="golCasa" placeholder="Gol Casa" value="0">
            <input type="number" id="golOspite" placeholder="Gol Ospite" value="0">
        </div>
        <button class="btn btn-green" onclick="salvaPartita()">Salva Partita</button>
        <button class="btn btn-red" onclick="tornaMenu()">Indietro</button>
    </div>

    <script type="module">
        import database from './database-supabase.js';

        // Inizializzazione dati
        async function init() {
            aggiornaDropdowns();
        }

        window.mostraSezione = function(id) {
            document.querySelectorAll('.sezione').forEach(s => s.classList.remove('attiva'));
            document.getElementById('menuPrincipale').style.display = 'none';
            document.getElementById(id).classList.add('attiva');
        }

        window.tornaMenu = function() {
            document.querySelectorAll('.sezione').forEach(s => s.classList.remove('attiva'));
            document.getElementById('menuPrincipale').style.display = 'grid';
        }

        async function aggiornaDropdowns() {
            const squadre = await database.getSquadre();
            const selects = ['squadraSelezionata', 'casaSelect', 'ospiteSelect'];
            
            selects.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.innerHTML = squadre.map(s => `<option value="${s.id}">${s.nome}</option>`).join('');
                }
            });
        }

        window.aggiungiSquadra = async function() {
            const nome = document.getElementById('nomeSquadra').value;
            if(!nome) return alert("Inserisci un nome");
            
            try {
                await database.aggiungiSquadra({ nome: nome, punti: 0, giocate: 0, vinte: 0, pareggiate: 0, perse: 0, gol_fatti: 0, gol_subiti: 0 });
                alert("Squadra aggiunta!");
                document.getElementById('nomeSquadra').value = '';
                aggiornaDropdowns();
            } catch (e) { alert("Errore: " + e.message); }
        }

        window.aggiungiGiocatore = async function() {
            const nome = document.getElementById('nomeGiocatore').value;
            const squadraId = document.getElementById('squadraSelezionata').value;
            const ruolo = document.getElementById('ruoloGiocatore').value;
            
            if(!nome) return alert("Inserisci nome");

            try {
                await database.aggiungiGiocatore({ 
                    nome: nome, 
                    squadra_id: parseInt(squadraId), 
                    ruolo: ruolo,
                    gol: 0, ammonizioni: 0, espulsioni: 0, mvp: 0, voto_medio: 0 
                });
                alert("Giocatore aggiunto!");
                document.getElementById('nomeGiocatore').value = '';
            } catch (e) { alert("Errore: " + e.message); }
        }

        window.salvaPartita = async function() {
            const casaId = document.getElementById('casaSelect').value;
            const ospiteId = document.getElementById('ospiteSelect').value;
            const gCasa = parseInt(document.getElementById('golCasa').value);
            const gOspite = parseInt(document.getElementById('golOspite').value);

            if(casaId === ospiteId) return alert("Le squadre devono essere diverse!");

            try {
                await database.aggiungiPartita({
                    squadra_casa_id: parseInt(casaId),
                    squadra_ospite_id: parseInt(ospiteId),
                    gol_casa: gCasa,
                    gol_ospite: gOspite,
                    data: new Date().toISOString()
                });
                alert("Partita salvata e classifica aggiornata!");
                tornaMenu();
            } catch (e) { alert("Errore: " + e.message); }
        }

        init();
    </script>
</body>
</html>
